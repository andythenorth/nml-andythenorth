<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>NML documentation</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<link rel="stylesheet" title="Standard Style" type="text/css" href="nml.css">
</head>
<body>

<h1><a name="vehicles">Vehicles</a></h1>

<h2><a name="vehicles-property">Properties common to all vehicle types</a></h2>
<table class="t">
<tr><th> property</th><th>value range</th><th>available for<br>articulated<br>vehicle</th><th>comment</th></tr>
<tr><td> name</td><td>                         (string)</td><td>yes</td><td>for example <code>string(STR_NAME_HEREFORD_TRAM)</code></td></tr>
<tr><td> climates_available</td><td>           bitmask(CLIMATE_XXX, CLIMATE_YYY, ...)</td><td>set to NO_CLIMATES</td><td>XXX = [TEMPERATE | ARCTIC | TROPICAL | TOYLAND], alternatively NO_CLIMATE or ALL_CLIMATES.
To make a vehicle available in all climates except toyland you could use: ALL_CLIMATES &amp; ~bitmask(CLIMATE_TOYLAND).</td></tr>
<tr><td> introduction_date</td><td>            date(yyyy,mm,dd)</td><td>no</td><td>Valid range for yyyy is 0 ... 5000000. In TTDPatch, dates after 2044 will be limited to 2044. Unless the engine is introduced within two years after game-start (always 1920 in TTDPatch), a random number of days between 0 and 511 will be added to this.</td></tr>
<tr><td> model_life</td><td>                   0 ... 254 (years) or VEHICLE_NEVER_EXPIRES</td><td>no</td><td>Number of years a model is "supported" by the manufacturer, before reliability starts dropping.</td></tr>
<tr><td> retire_early</td><td>                 (years)</td><td>no</td><td>Number of years before <i>model_life</i> when no new vehicles can be bought. May be negative.</td></tr>
<tr><td> vehicle_life</td><td>                 0 ... 255 (years)</td><td>no</td><td>Age of a vehicle when it gets old.</td></tr>
<tr><td> reliability_decay</td><td>            0 ... 255</td><td>no</td><td>Default vehicles use 20. The higher the value the faster reliability decays, the more frequent service is needed. 0 means reliability never decreases if the vehicle is not too old</td></tr>
<tr><td> refittable_cargo_classes</td><td>     bit set of <a href="cargos.html#cargos-property">cargo classes</a></td><td>yes</td><td>for example: <code>bitmask(CC_BULK, CC_COVERED)</code></td></tr>
<tr><td> non_refittable_cargo_classes</td><td> bit set of <a href="cargos.html#cargos-property">cargo classes</a></td><td>yes</td><td>for example: <code>bitmask(CC_OVERSIZED, CC_SPECIAL)</code></td></tr>
<tr><td> refittable_cargo_types</td><td>       bit mask of entries into the cargo translation table</td><td>yes</td><td>example: <code>bitmask(PASS, MAIL, GOOD)</code></td></tr>
<tr><td> loading_speed <td>                    0 ... 255 (cargo units)</td><td>yes</td><td>Units of cargo loaded per tick. Default vehicles use 5 for trains and road vehicles, 10 for ships and 20 for aircraft</td></tr>
<tr><td> cost_factor</td><td>                  0 ... 255</td><td>=0</td><td>multiplier to the base purchase cost</td></tr>
<tr><td> running_cost_factor</td><td>          0 ... 255</td><td>=0</td><td>multiplier to the base running costs</td></tr>
<tr><td> cargo_age_period</td><td>             0 ... 65535</td><td>yes</td><td>This property specifies after how many ticks cargo is aged. Default value is 185. 74 ticks is equal to 1 day.</td></tr>
</table>

<p>To determine whether your vehicle can be refitted to a certain cargo, OpenTTD uses the following table:</p>
<table class="t">
<tr><th>Cargo matches refittable_cargo_classes</th><th>Cargo matches non_refittable_cargo_classes</th><th>Cargo in refittable_cargo_types</th><th>Result</th></tr>
<tr><td>No</td><td>Doesn't matter</td><td>No</td><td>Not refittable</td></tr>
<tr><td>No</td><td>Doesn't matter</td><td>Yes</td><td>Refittable</td></tr>
<tr><td>Yes</td><td>No</td><td>No</td><td>Refittable</td></tr>
<tr><td>Yes</td><td>No</td><td>Yes</td><td>Not refittable</td></tr>
<tr><td>Yes</td><td>Yes</td><td>No</td><td>Not refittable</td></tr>
<tr><td>Yes</td><td>Yes</td><td>Yes</td><td>Refittable</td></tr>
</table>
<p>You should use refittable_cargo_classes and non_refittable_cargo_classes to
decide to which cargos your vehicle is refittable, and only use
refittable_cargo_types as a last resort to include/exclude some cargo type.</p>
<p>Note that the default cargo cannot be selected explicitly. Instead it is
automatically set to use the first refittable cargo, whenever one of the
refitting properties is set.</p>

<h2><a name="trains-property">Train properties</a></h2>
<table class="t">
<tr><th> property</th><th>value range</th><th>available for<br>articulated<br>vehicle</th><th>comment</th></tr>

<!-- properties common to all vehicle types but with different value ranges or meaning -->
<tr><td> sprite_id</td><td>SPRITE_ID_NEW_TRAIN</td><td>yes</td><td>Set this property to enable new graphics</td></tr>
<tr><td> speed<td> 0 ... 65000 (speed units)<td>no</td><td>Max speed for engines, speed limit for wagons
<tr><td> misc_flags</td><td> bitmask(TRAIN_FLAG_XXX, ...)</td><td>FLIP should not be set, TILT and MU the same value</td><td>XXX=[TILT | 2CC | MU | FLIP] which allows the train to enjoy the tilt bonus, use the 
2nd company colour, act as a multiple unit (used for livery selection only) or allow the vehicle to be flipped (reversed) in the depot</td></tr>
<tr><td> refit_cost<td> 0 ... 255 <td>yes</td><td> in 50% units of the purchase price cost base
<tr><td> callback_flags<td> bitmask(VEH_CBF_XXX, ...)<td>yes<td>Do not set this, unless you use <a href="old-callbacks.html#old-callbacks-vehicles">old-style callbacks</a>.

<!-- properties not present for all vehicle types -->
<tr><td> track_type<td>item from railtypetable<td>must be the same as front<td>Default railtype table: RAIL, MONO, MGLV.
If you install a railtypetable yourself you'll always get the railtype you specified. If you
want a vehicle to run on electric rail and you don't have a railtypetable, set <tt>track_type</tt>
to RAIL and make sure that you set <tt>engine_class</tt> to ENGINE_CLASS_ELECTRIC.
<tr><td> ai_special_flag<td> [AI_FLAG_PASSENGER | AI_FLAG_CARGO]<td>no<td> Set to AI_FLAG_PASSENGER to tell computer players that it's an engine that should only be used for passenger service.
<tr><td> power<td> 0 ... 65000 hp (power units)<td>=0<td>
<tr><td> running_cost_base</td><td>RUNNING_COST_XXX</td><td>=0<td>XXX = [STEAM | DIESEL | ELECTRIC | ROADVEH | NONE]</td></tr>
<tr><td> dual_headed<td> [0 | 1]<td>=0 for both parts<td>1 = dual_headed, otherwise normal engine
<tr><td> cargo_capacity<td> 0 .. 255 <td>yes<td>
<tr><td> weight<td> 0 .. 1279 ton (mass units)<td>=0<td>
<tr><td> ai_engine_rank<td> 0 ... 255<td>no<td>TTDPatch only: Higher values make the engine for the TTDPatch AI more attractive
<tr><td> engine_class<td> ENGINE_CLASS_XXX<td>no<td>XXX=[STEAM | DIESEL | ELECTRIC | MONORAIL | MAGLEV]
<tr><td> extra_power_per_wagon<td> 0 ... 65000 hp (power units) <td>=0<td>Only wagons with a livery override for this engine will add power
<tr><td> tractive_effort_coefficient<td> 0 ... 1<td>=0<td>
<tr><td> air_drag_coefficient</td><td>   0 ... 1</td><td>=0<td></td></tr>
<tr><td> shorten_vehicle<td> SHORTEN_TO_XXX<td>yes<td>XXX=[8_8 | 7_8 | ... | 1_8]
<tr><td> visual_effect_and_powered<td> visual_effect_and_powered(VISUAL_EFFECT_XXX, offset, ENABLE_WAGON_POWER or DISABLE_WAGON_POWER)<td>yes<td>XXX=[DEFAULT | STEAM | DIESEL | ELECTRIC | DISABLE], it is the 
type of the visual effect you want for this vehicle. Default means "take from engine_class property". Offset is the position of the effect. 0 is default, negative values
mean more to the front and positive values are backwards. Minimum offset is -8, maximum is 7.
<tr><td> extra_weight_per_wagon<td> 0 ... 255 ton (mass units)<td>=0<td>Adds extra weight for powered wagons, see extra_power_per_wagon
<tr><td> <a name="bitmask_vehicle_info">bitmask_vehicle_info</a><td> 8-bit bitmask<td>yes<td>Used for obtaining <a href="#bitmask_consist_info">bitmask_consist_info</a>
</table>

<h2><a name="roadvehs-property">Road vehicle properties</a></h2>
<table class="t">
<tr><th> property</th><th>value range</th><th>available for<br>articulated<br>vehicle</th><th>comment</th></tr>
<!-- properties common to all vehicle types but with different value ranges or meaning -->
<tr><td> sprite_id</td><td>                    SPRITE_ID_NEW_ROADVEH</td><td>yes<td>Set this property to enable new graphics</td></tr>
<tr><td> speed</td><td>                        0 ... 514km/h (speed units)</td><td>no<td></td></tr>
<tr><td> misc_flags</td><td>                   bitmask(ROADVEH_FLAG_XXX, ...)</td><td>partly; tram flag must the same<td>The following flags are defined: ROADVEH_FLAG_TRAM, ROADVEH_FLAG_2CC. 
Use 0 if you don't want to set any of these flags.</td></tr>
<tr><td> refit_cost<td> 0 ... 255 <td>yes<td> in 25% units of the purchase price cost base
<tr><td> callback_flags<td> bitmask(VEH_CBF_XXX, ...)<td>yes<td>Do not set this, unless you use <a href="old-callbacks.html#old-callbacks-vehicles">old-style callbacks</a>.

<!-- properties not present for all vehicle types -->
<tr><td> running_cost_base</td><td>            RUNNING_COST_XXX</td><td>set to RUNNING_COST_NONE<td>XXX = [STEAM | DIESEL | ELECTRIC | ROADVEH | NONE]</td></tr>
<tr><td> power</td><td>                        0 ... 2550hp (power units)</td><td>=0<td></td></tr>
<tr><td> weight</td><td>                       0 ... 63.75ton (mass units)</td><td>=0<td></td></tr>
<tr><td> tractive_effort_coefficient</td><td>  0 ... 1</td><td>=0<td></td></tr>
<tr><td> air_drag_coefficient</td><td>         0 ... 1</td><td>=0<td></td></tr>
<tr><td> cargo_capacity</td><td>               0 ... 255</td><td>yes<td></td></tr>
<tr><td> sound_effect</td><td>                 SOUND_XXX</td><td>no<td>See available <a href="refs.html#refs-sounds">sound effects</a>.</td></tr>
<tr><td> visual_effect<td> visual_effect(VISUAL_EFFECT_XXX, offset)<td>yes<td>XXX=[DEFAULT | STEAM | DIESEL | ELECTRIC | DISABLE], it is the 
type of the visual effect you want for this vehicle. Default means no effect. Offset is the position of the effect. 0 is default, negative values
mean more to the front and positive values are backwards. Minimum offset is -8, maximum is 7.

</table>
<h2><a name="ships-property">Ship properties</a></h2>
<table class="t">
<tr><th> property</th><th>value range</th><th>comment</th></tr>
<!-- properties common to all vehicle types but with different value ranges or meaning -->
<tr><td> sprite_id <td> SPRITE_ID_NEW_SHIP <td>Set this property to enable new graphics
<tr><td> speed</td><td> 0 ... 127 km/h (speed units)</td><td></td></tr>
<tr><td> misc_flags<td> bitmask(SHIP_FLAG_2CC)<td> Bitmask with (currently) only one possible flag, set to 0 to disable
<tr><td> refit_cost<td> 0 ... 255 <td> in 1/32 of the default refit cost base
<tr><td> callback_flags<td> bitmask(VEH_CBF_XXX, ...)<td>Do not set this, unless you use <a href="old-callbacks.html#old-callbacks-vehicles">old-style callbacks</a>.

<!-- properties not present for all vehicle types -->
<tr><td> is_refittable <td> [0 | 1] <td>0=false, 1=true. Note: if you do not set this property to 1, then refittable_cargo_classes /
non_refittable_cargo_classes have no effect.
<tr><td> cargo_capacity<td>0 ... 255<td>
<tr><td> sound_effect<td> SOUND_XXX<td>See available <a href="refs.html#refs-sounds">sound effects</a>.
<tr><td> ocean_speed_fraction<td>0 ... 1<td> fraction of base speed on ocean tiles (currently works in TTDPatch only)
<tr><td> canal_speed_fraction<td>0 ... 1<td> fraction of base speed on canal tiles (currently works in TTDPatch only)
<tr><td> visual_effect<td> visual_effect(VISUAL_EFFECT_XXX, offset)<td>XXX=[DEFAULT | STEAM | DIESEL | ELECTRIC | DISABLE], it is the 
type of the visual effect you want for this ship. Default means no effect. Offset is the position of the effect. 0 is default, negative values
mean more to the front and positive values are backwards. Minimum offset is -8, maximum is 7.

</table>
<h2><a name="planes-property">Plane properties</a></h2>
<table class="t">
<tr><th> property</th><th>value range</th><th>comment</th></tr>
<!-- properties common to all vehicle types but with different value ranges or meaning -->
<tr><td> sprite_id <td> SPRITE_ID_NEW_AIRCRAFT <td>Set this property to enable new graphics
<tr><td> speed<td> 0 .. 3280 km/h (speed units)<td>
<tr><td> misc_flags<td> bitmask(AIRCRAFT_FLAG_2CC)<td> Bitmask with (currently) only one possible flag, set to 0 to disable
<tr><td> refit_cost<td> 0 ... 255 <td> in 1/32 of default refit cost base
<tr><td> callback_flags<td> bitmask(VEH_CBF_XXX, ...)<td>Do not set this, unless you use <a href="old-callbacks.html#old-callbacks-vehicles">old-style callbacks</a>.

<!-- properties not present for all vehicle types -->
<tr><td> is_helicopter<td> AIRCRAFT_TYPE_XXX<td>XXX=[NORMAL | HELICOPTER]
<tr><td> is_large<td> AIRCRAFT_TYPE_XXX<td>XXX=[SMALL | LARGE]. Set to AIRCRAFT_TYPE_SMALL for helicopters.
<tr><td> acceleration<td>0 ... 255 <td> In arbitrary units
<tr><td> passenger_capacity<td> 0 ... 65536<td>
<tr><td> mail_capacity<td> 0 ... 255<td>
<tr><td> sound_effect<td> SOUND_XXX<td>See available <a href="refs.html#refs-sounds">sound effects</a>.
</table>


<h2><a name="vehicles-vars">Vehicle variables</a></h2>
<p>Below an overview of all vehicle-specific variables. Not that in the
purchase list, the vehicle is not built yet and as such many variables are not
available. All general variables are available, refer to the table for info
on vehicle-specific variables. Trying to access a non-available variable
invokes undefined behaviour. Please note that while all variables are
available for all vehicles types, some of them only make sense for one or more
vehicle types. For example checking current_railtype for a non-rail vehicle
doesn't make sense at all.</p>
<h3><a name="vehicles-normal-vars">Variables without parameter</a></h3>
<table class="t">
<tr><th>name<th>value range<th>available in<br>purchase list?<th>comment
<tr><td>position_in_consist <td>0 ... 255<td>No<td>The position of the current vehicle-part from the start of the vehicle. The engine will
get value 0, the first wagon (or second engine) gets value 1, etc.
<tr><td>position_in_consist_from_end <td>0 ... 255 <td>No<td>Same as position_in_consist but counted from the end. The last wagon will
get value 0.
<tr><td>num_vehs_in_consist <td>1 ... 256 <td>No<td>The total number of vehicles-parts in this vehicle. For aircraft this will include
the shadow and the rotor.
<tr><td>position_in_vehid_chain <td>0 ... 255 <td>No<td>See position_in_consist, but not of the complete vehicle but only all consecutive
parts with the same id.
<tr><td>position_in_vehid_chain_from_end <td>0 ... 255 <td>No<td>See position_in_consist_from_end, but not of the complete vehicle but only all consecutive
parts with the same id.
<tr><td>num_vehs_in_vehid_chain <td>1 ... 256 <td>No<td>See num_vehs_in_consist, but not of the complete vehicle but only all consecutive
parts with the same id.
<tr><td>cargo_classes_in_consist <td>Bitmask of CC_XXX <td>No<td><a href="cargos.html#cargos-property">cargo classes</a>
<tr><td>most_common_refit <td><a href="cargos.html#cargos-property">cargo class</a><td>No<td>cargo class most often refit to
<tr><td><a name="bitmask_consist_info">bitmask_consist_info</a><td>Bitmask 8 bit<td>No<td>
Binary OR of the values of <a href="#bitmask_vehicle_info">bitmask_vehicle_info</a>
of all vehicles (engines, wagons) in the consist. Only available for rail vehicles.
<tr><td>company_num <td>0 ... 14 <td>Yes<td>company number of the vehicle owner. TTDPatch only supports up to 8 companies (0 ... 7)
<tr><td>company_type <td>PLAYERTYPE_XX <td>Yes<td>PLAYERTYPE_HUMAN, PLAYERTYPE_AI, PLAYERTYPE_HUMAN_IN_AI
(human managing AI company) or PLAYERTYPE_AI_IN_HUMAN (AI managing human company). OpenTTD only
uses PLAYERTYPE_HUMAN and PLAYERTYPE_AI. If you cheat yourself to be part of an AI company OpenTTD
will still report PLAYERTYPE_AI for the company with yourself and the AI and it'll report
PLAYERTYPE_HUMAN for the now uncontrolled company.
<tr><td>company_colour1 <td>COLOUR_XXX <td>Yes<td>Refer to the table <a href="refs.html#refs-palettes-helpers">here</a> for possible values.
<tr><td>company_colour2 <td>COLOUR_XXX <td>Yes<td>Same as company_colour1, if no 2nd company colour is chosen.
Refer to the table <a href="refs.html#refs-palettes-helpers">here</a> for possible values.
<tr><td>aircraft_height <td>0 ... 255 <td>No<td>Height difference between the aircraft and its shadow. 8 Units are equivalent to one height level on the map.
<tr><td>airport_type <td>AIRPORTTYPE_XX <td>No<td>AIRPORTTYPE_SMALL, AIRPORTTYPE_LARGE, AIRPORTTYPE_HELIPORT or AIRPORTTYPE_OILRIG
<tr><td>curv_info_prev_cur <td>-2 ... 2 <td>No<td>Curvature to the right is positive. 1 unit is 45 degrees.
<tr><td>curv_info_cur_next <td>-2 ... 2 <td>No<td>Curvature to the right is positive. 1 unit is 45 degrees.
<tr><td>curv_info_prev_next <td>-4 ... 4 <td>No<td>Curvature to the right is positive. 1 unit is 45 degrees.
<tr><td>motion_counter <td>0 ... 15 <td>Yes, always 0<td>Is increased every time the vehicle moves a single step on the map. Useful for animations.
<tr><td>cargo_type_in_veh <td>entry in cargo translation table <td>Yes, for the default cargo<td> 0xFF if not present in the table
<tr><td>cargo_unit_weight <td>weight per unit in 1/16t <td>Yes, for the default cargo<td>
<tr><td>cargo_classes <td><a href="cargos.html#cargos-property">cargo class</a><td>Yes, for the default cargo<td>class of the currently transported cargo
<tr><td>vehicle_is_available <td> [0 | 1]<td>Yes<td>Value is 1 if the vehicle is available on the open market
<tr><td>vehicle_is_testing <td> [0 | 1]<td>Yes<td>Value is 1 if the vehicle is currently being tested
<tr><td>vehicle_is_offered <td> [0 | 1]<td>Yes<td>Value is 1 if the vehicle is currently being offered for exclusive preview
<tr><td>build_year <td>0 ... 5000000 <td>Yes<td>0-based year when the vehicle was built, current year if the vehicle is not built yet
<tr><td>direction <td>DIRECTION_XX <td>No<td>See <a href="refs.html#refs-directions">here</a> for an overview of possible values and their meaning.
<tr><td>cargo_capacity <td>0 ... 65535 <td>No<td>Cargo capacity (number of units) of the vehicle
<tr><td>cargo_count <td>0 ... 65535 <td>No<td>Number of cargo units of cargo in the vehicle
<tr><td>vehicle_type_id <td> <td>No<td>ID of the vehicle
<tr><td>cargo_subtype <td>0 ... 255 <td>Yes, always 0<td>Cargo subtype, used to provide more than one refit option for the same cargo type. See also the <code>cargo_subtype_text</code> callback.
<tr><td>vehicle_is_powered <td> [0 | 1]<td>No<td>Vehicle provides power and is on the correct track type
<tr><td>vehicle_is_not_powered <td> [0 | 1]<td>No<td>Vehicle is either on a wrong track type or it doesn't provide power at all
<tr><td>vehicle_is_potentially_powered <td> [0 | 1]<td>No<td>Vehicle provides power, if it is on a suitable track type
<tr><td>vehicle_is_reversed <td> [0 | 1]<td>No<td>Value is 1 if the vehicle has reversed an odd number of times
<tr><td>built_during_preview <td> [0 | 1]<td>No<td>Value is 1 if the vehicle was built during the exclusive preview stage
<tr><td>current_railtype <td>No<td>Entry from railtype translation table or 0xFF<td>Don't use this variable unless you've defined
a railtype translation table. If the train is running on a railtype that is not listed in your railtype translation table
this variable will contain 0xFF. Available since OpenTTD r20164.
<tr><td>waiting_triggers <td> <td>No<td>Random triggers waiting to be matched. (see <a href="nml-language.html#block-randomswitch">Random switch</a>)
<tr><td>random_bits <td>0 ... 255 <td>No<td>Random data that can be used to randomize certain descisions. (see <a href="nml-language.html#block-randomswitch">Random switch</a>)
<tr><td>grfid <td>0 ... 0xFFFFFFFF <td>No<td>GRFID that defined the <a href="nml-language.html#block-item-graphics">graphics</a>-block for this vehicle.
To compare this with other grfids, use the <a href="nml-language.html#builtin-functions">builtin function</a>
<code>str2number()</code> to convert the other GRFID to a number as well.
<tr><td>vehicle_is_hidden <td> [0 | 1]<td>No<td>Value is 1 if the vehicle is hidden in a depot or tunnel.
<tr><td>vehicle_is_stopped <td> [0 | 1]<td>No<td>Value is 1 if the vehicle is stopped, or if it is braking for a stop (trains only).
<tr><td>vehicle_is_crashed <td> [0 | 1]<td>No<td>Value is 1 if the vehicle has crashed.
<tr><td>vehicle_is_broken <td> [0 | 1]<td>No<td>Value is 1 if the vehicle is broken down.
<tr><td>date_of_last_service <td>date(year, month, day)<td>No<td>Not valid before 1920 and after 2090.
<tr><td>breakdowns_since_last_service <td>0 ... 255 <td>No<td>Number of breakdowns since the last service
<tr><td>reliability <td>0 ... 100 <td>No<td>Reliability (percentage)
<tr><td>age_in_days <td>0 ... 65535 <td>No<td>Vehicle age in days.
<tr><td>max_age_in_days <td>0 ... 65535 <td>No<td>Maximum vehicle age in days.
<tr><td>current_speed <td>(speed units)<td>No<td>The current speed of the vehicle in m/s
<tr><td>max_speed <td>(speed units)<td>No<td>The maximum speed of the vehicle in m/s
<tr><td>vehicle_is_in_depot <td> [0 | 1]<td>No<td>Value is 1 if the vehicle is inside a depot
</table>
<h3><a name="vehicles-parameter-vars">Variables that require an argument</a></h3>
<table class="t">
<tr><th>name</th><th>Argument</th><th>value range</th><th>available in<br>purchase list?</th><th>comment</th></tr>
<tr><td>count_veh_id</td><td>The vehicle ID to look for.</td><td>0..255</td><td>No</td><td>The number of vehicles in the current consist that have
the given ID.</td></tr>
</table>

<h2><a name="vehicles-callbacks">Vehicle callbacks</a></h2>

<table class="t">
<tr><th>Name<th>Available for<th>In purchase menu?<th>value range<th>comment
<tr><td>default<td>All<td>Yes, unless <code>purchase</code> is set separately<td>Sprite group<td>'Normal' vehicle graphics
<tr><td>purchase<td>All<td>Yes, only<td>Sprite group<td>Graphics to show in the buy menu (only the horizontal view is needed)
<tr><td>rotor<td>Aircraft (helicopters)<td>No<td>Sprite group<td>Graphics for the helicopter rotor (4 sprites; 1 stopped and 3 moving)
<tr><td>random_trigger<td>All<td>No<td>N/A<td>See <a href="nml-language.html#block-randomswitch">random switch</a> for more information.
<tr><td>cargo_subtype_text<td>All<td>No<td>String, or 0xFF<td>
With this callback, you can display extra text after the cargo in the vehicle
information window. This callback is called during refitting, with succesively
increased values of the <code>cargo_subtype</code> variable, until the callback
returns 0xFF. All returned strings are then displayed as refit options. The
chosen refit option is saved in the <code>cargo_subtype</code> variable, so
it can be used later for other things. In HEQS for example, this mechanism is
used to let the user choose between different capacities of the same vehicle.
<tr><td>additional_text<td>All<td>Yes, only<td>String<td>Additional text to show in the purchase list.
<tr><td>colour_mapping<td>All<td>Yes, unless <code>purchase_colour_mapping</code> is set separately<td>Recolour sprite number<td>
With this callback, you can use a different recolour sprite instead of the
standard 1cc / 2cc company colour remappings. See <a href="refs.html#refs-palettes">
here</a> for a list of default palettes. See the <a href="nml-language.html#builtin-functions">builtin function</a>
<code>reserve_sprites()</code> for info on how to allocate your own sprite.
For performance, the result is cached and only updated if the <code>
every_32_days</code> callback requires so. Add CB_RESULT_COLOUR_MAPPING_ADD_CC
to the result to add the company colour to the sprites, this requires 16 (1cc)
or 256 (2cc) sprites in total.
<tr><td>start_stop<td>All<td>No<td>String or 0xFF<td>Called when starting or
stopping a vehicle. Mainly useful to prevent vehicles from leaving the depot
unless a certain condition is met. Return 0xFF to allow or a string (containing
an error message) to disallow starting/stopping.
<tr><td>every_32_days<td>All<td>No<td>bitmask(CB_RESULT_32_DAYS_XXX, ...)<td>Called every 32 days. Set
CB_RESULT_32_DAYS_TRIGGER in the bitmask to trigger TRIGGER_VEHICLE_32_CALLBACK. Set
CB_RESULT_32_DAYS_COLOUR_MAPPING in the bitmask to update the colour mapping by
re-running the <code>colour_mapping</code> callback.
<tr><td>sound_effect<td>All<td>No<td>SOUND_XXX, sound("sound.wav"), import_sound(grfid, number) or CB_RESULT_NO_SOUND
<td>Called to play various vehicle sounds. <code>extra_callback_info1</code>
contains the sound event, see the <a href="#vehicles-callbacks-sound-events">table</a>
below. Return SOUND_XXX (see <a href="refs.html#refs-sounds">here</a>) to return
a default sound. <code>sound("soundfile")</code> imports a sound from a .wav file.
<code>import_sound(grfid, number)</code> imports a sound from another grf.
A failed (or not implemented) callback will cause the default sound to be
played. Return CB_RESULT_NO_SOUND to play no sound at all.
<tr><td>articulated_part<td>Trains, Road Vehicles<td>Yes (no separate callback)<td>Vehicle ID, or 0xFF<td>
With this callback, you can add articulated parts (e.g. tenders) to your
vehicle. Called repeatedly, until 0xFF is returned. After each call, the
returned vehicleID is added to your vehicle. <code>extra_callback_info1</code>
contains 1 during the first call, 2 during the second, etc. Note that callback
may be called from the purchase list, using vehicle variables is not possible.
Add 128 to the returned vehicle ID to display the vehicle backwards. This has
the unfortunate side-effect of requiring the vehicle ID of the articulated part
to be in the range 0 .. 127, currently there's no way around this limitation.
<tr><td>can_attach_wagon<td>Trains<td>No<td>String or CB_RESULT_ATTACH_XXX<td>
Called when a wagon is being attached, to allow or disallow attaching.
This callback has to be defined at the engine. However, variables in the
<code>SELF</code> scope refer to the wagon being attached, the <code>PARENT</code>
scope refers to the engine that the wagon is being attached to.
Return a string to disallow with the string as error message. Return
CB_RESULT_ATTACH_DISALLOW to disallow with standard message ("incompatible
railtypes"), CB_RESULT_ATTACH_ALLOW to allow or CB_RESULT_ATTACH_ALLOW_IF_RAILTYPES
to allow if the railtypes match (default).
</table>
<p>The following callbacks all have an equivalent property.
The property description applies here also, except where otherwise noted.</p>
<table class="t">
<tr><th>Name<th>Available for<th>In purchase menu?<th>comment
<tr><td>loading_speed<td>All<td>No<td>
<tr><td>speed<td>All<td>Yes, unless <code>purchase_speed</code> is set separately<td>Units are not (yet) available
<tr><td>cost_factor<td>All<td>Yes, only<td>
<tr><td>running_cost_factor<td>All<td>Yes, unless <code>purchase_running_cost_factor</code> is set separately<td>
<tr><td>cargo_age_period<td>All<td>No<td>
<tr><td>cargo_capacity<td>All except aircraft<td>Yes, unless <code>purchase_cargo_capacity</code> is set separately<td>
<tr><td>passenger_capacity<td>Aircraft<td>Yes, unless <code>purchase_passenger_capacity</code> is set separately<td>
<tr><td>mail_capacity<td>Aircraft<td>Yes, unless <code>purchase_mail_capacity</code> is set separately<td>
<tr><td>visual_effect_and_powered<td>Trains<td>No<td>
<tr><td>visual_effect<td>Road Vehicles, Ships<td>No<td>
<tr><td>power<td>Trains, Road Vehicles<td>Yes, unless <code>purchase_power</code> is set separately<td>Units are not (yet) available
<tr><td>weight<td>Trains, Road Vehicles<td>Yes, unless <code>purchase_weight</code> is set separately<td>Units are not (yet) available
<tr><td>shorten_vehicle<td>Trains, Road vehicles<td>No<td>
<tr><td>tractive_effort_coefficient<td>Trains, Road Vehicles<td>Yes, unless <code>purchase_tractive_effort_coefficient</code> is set separately<td>Value range is 0 .. 255 instead of 0 .. 1.
<tr><td>bitmask_vehicle_info<td>Trains<td>No<td>
</table>

<h3><a name="vehicles-callbacks-sound-events">Sound events</a></h3>
<table class="t">
<tr><th>Event<th>Description
<tr><td>SOUND_EVENT_START<td>Vehicle leaves station or depot, plane takes off
<tr><td>SOUND_EVENT_TUNNEL<td>Vehicle enters tunnel
<tr><td>SOUND_EVENT_BREAKDOWN<td>Vehicle breaks down (not for planes)
<tr><td>SOUND_EVENT_RUNNING<td>Once per engine tick, but no more than once per vehicle motion
<tr><td>SOUND_EVENT_TOUCHDOWN<td>Aircraft touches down
<tr><td>SOUND_EVENT_VISUAL_EFFECT<td>Visual effect is generated (steam plume, diesel smoke, electric spark)
<tr><td>SOUND_EVENT_RUNNING_16<td>Every 16 engine ticks if in motion
<tr><td>SOUND_EVENT_STOPPED<td>Every 16 engine ticks if stopped
<tr><td>SOUND_EVENT_LOAD_UNLOAD<td>Consist loads or unloads cargo
</table>

</body>
</html>

