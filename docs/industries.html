<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>NML documentation</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<link rel="stylesheet" title="Standard Style" type="text/css" href="nml.css">
</head>
<body>

<h1><a name="industries">Industries</a></h1>

<h2><a name="industries-vars">Industry variables</a></h2>
Variables that require some parameters.
<table class="t">
<tr><th>name</th><th>arguments</th><th>comment</th></tr>
<tr><td>industry_count</td><td>industry_type, grfid&nbsp;=&nbsp;-1</td><td>The value of this variable is the number
of industries of a given type that are currently on the map. industry_type is either the ID of an
industry. GRFid is the grf in which the industry was defined. The default value is -1, which means
current newgrf. A grfid of 0 lets you check the number of default industries of a given type.</td></tr>
<tr><td>industry_distance</td><td>industry_type, grfid&nbsp;=&nbsp;-1</td><td>The value of this variable is the
manhattan distance the closest instance of the given industry or 0xFFFF if not applicable. See
industry_count for a description of the parameters.</td></tr>
<tr><td>industry_layout_count / industry_layout_distance</td><td>industry_type, layout, grfid&nbsp;=&nbsp;-1.</td>
<td>See industry_count / industry_distance for description of industry_type, grfid and return value. The
results are filtered to industries that have the given layout number.</td></tr>
</table>

<h2><a name="industrytiles-vars">Industry tile variables</a></h2>
Variables that require a signed x,y offset. The offset is relative to the current tile. Offset 0,0 means the current tile.
<table class="t">
<tr><th>name</th><th>value range</th><th>comment</th></tr>
<tr><td>nearby_tile_slope</td><td>Which corners are raised on the given tile.</td><td>
Bit 0: west corner is above the lowest corner.<br>
Bit 1: south corner is above the lowest corner.<br>
Bit 2: east corner is above the lowest corner.<br>
Bit 3: north corner is above the lowest corner.<br>
Bit 4: this tile is a steep slope (the corner opposite to the lowest corner is 2 units higher).
</td></tr>
<tr><td>nearby_tile_is_same_industry</td><td>1 if the tile is part of the same industry, 0 otherwise</td><td></td></tr>
<tr><td>nearby_tile_is_water</td><td>1 if the tile is water, 0 otherwise</td><td></td></tr>
<tr><td>nearby_tile_terrain_type</td><td>TILETYPE_NORMAL, TILETYPE_DESERT, TILETYPE_RAIN_FOREST, TILETYPE_SNOW</td><td></td></tr>
<tr><td>nearby_tile_height</td><td>0..120</td><td>The height of the lowest corner of the given tile.</td></tr>
<tr><td>nearby_tile_animation_frame</td><td>0..255</td><td>Animation frame of the given tile</td></tr>
<tr><td>nearby_tile_industrytile_id</td><td>0x00aa, 0xFFbb, 0xFFFE or 0xFFFF</td><td>
0x00aa: The tile is an industry tile that is part of this GRF, the tile id is aa.<br>
0xFFbb: The tile is an original industry tile with id bb.<br>
0xFFFE: The tile is an industry tile defined in another GRF.<br>
0xFFFF: The tile is not an industry tile or it belongs to another GRF.
</td></tr>
</table>

<h2><a name="industrytiles-property">Industry tile properties</a></h2>
<table class="t">
<tr><th>property</th><th>value range</th><th>comment</th></tr>
<tr><td>substitute</td><td><a href="refs.html#refs-default-industrytiles">0..174</a></td><td>number of the default industry tile which can replace this one, if this tile is not available for some reason.</td></tr>
<tr><td>override</td><td><a href="refs.html#refs-default-industrytiles">0..174</a></td><td>id of the default industry tile which this tile replaces. This is ignored, if the default industry tile has already been overridden. You can define this property multiple times</td></tr>
<tr><td>accepted_cargos</td><td>Array with up to 3 [cargo_id, amount]-pairs.</td><td>The cargos that are accepted by this tile. CargoID is a cargo type from 
your cargo translation table, amount is the acceptance of the given cargo in 1/8 units.<br>
Example: to make a tile accept both COAL and IORE you could use this: <code>accepted_cargos: [[COAL, 8], [IORE, 8]];</code><br>
Example: for a tile that doesn't any cargos at all you'd use: <code>accepted_cargos: [];</code></td></tr>
<tr><td>land_shape_flags</td><td>bitmask(<a href="#land-shape-flags">Land shape flags</a>)</td><td></td></tr>
<tr><td>callback_flags</td><td>bitmask(INDTILE_CBF_XXX, INDTILE_CBF_YYY)</td><td>XXX = ANIM_NEXT_FRAME | ANIM_SPEED | CARGO_AMOUNT_ACCEPT
| CARGO_TYPE_ACCEPT | SLOPE_IS_SUITABLE | FOUNDATIONS | AUTOSLOPE</td></tr>
<tr><td>animation_info</td><td>Array [ANIMATION_XXX, frame-count]</td><td>XXX = [LOOPING | NON_LOOPING], 1..253 frames</td></tr>
<tr><td>animation_speed</td><td>0..16</td><td>Speed of animation, see <a href="refs.html#refs-animation-speed-values">animation speed table</a> for the meaning of the values.</td></tr>
<tr><td>animation_triggers</td><td>bitmask(<a href="#industrytiles-animation-control">Animation control callback triggers</a>)</td><td>Triggers which control whether the animatin is started or stopped</td></tr>
<tr><td>special_flags</td><td>0..1</td><td>Set to 1 if INDTILE_CB_ANIM_NEXT_FRAME needs random bits</td></tr>
</table>

<h3><a name="land-shape-flags">Land shape flags</a></h3>
<table class="t">
<tr><th>Flag</th><th>Meaning</th></tr>
<tr><td>LSF_CANNOT_LOWER_NW_EDGE</td><td>North-west edge cannot be lowered</td></tr>
<tr><td>LSF_CANNOT_LOWER_NE_EDGE</td><td>North-east edge cannot be lowered</td></tr>
<tr><td>LSF_CANNOT_LOWER_SW_EDGE</td><td>South-west edge cannot be lowered</td></tr>
<tr><td>LSF_CANNOT_LOWER_SE_EDGE</td><td>South-east edge cannot be lowered</td></tr>
<tr><td>LSF_ONLY_ON_FLAT_LAND</td><td>This tile can only be built on flat land</td></tr>
<tr><td>LSF_ALLOW_ON_WATER</td><td>The land/water check is disabled for this tile so it can be built on water. If you need
more control over this use callback 0x2F.</td></tr>
</table>

<h3><a name="industrytiles-animation-control">Animation control callback triggers</a></h3>
<table class="t">
<tr><th>Trigger</th><th>Meaning</th></tr>
<tr><td>INDTILE_TRIGGER_CONSTRUCTION_STATE</td><td>the construction state changes </td></tr>
<tr><td>INDTILE_TRIGGER_TILE_LOOP</td><td>the tile is processed in the periodic processing loop </td></tr>
<tr><td>INDTILE_TRIGGER_INDUSTRY_LOOP</td><td>the industry of the tile is processed in the periodic processing loop (synchronized animation) </td></tr>
<tr><td>INDTILE_TRIGGER_INDUSTRY_RECEIVED_CARGO</td><td>the industry of the tile receives input cargo from a station </td></tr>
<tr><td>INDTILE_TRIGGER_INDUSTRY_DISTRIBUTES_CARGO</td><td>the industry distributes its output cargo to one of the stations nearby</td></tr>
</table>

<h2><a name="industries-property">Industry properties</a></h2>
Industry properties.
Default industry type numbers can be found at <a href="refs.html#refs-default-industries">default industries</a>.
<p>
<table class="t">
<tr><th>property</th><th>value range</th><th>comment</th></tr>
<tr><td>substitute</td><td>industry type</td><td>Number of the industry type replaced, <code>0xFF</code> disables the original industry with the same ID.</td></tr>
<tr><td>override</td><td>industry type</td><td>Number of the industry type overridden (where your industry does something completely different than the original).</td></tr>
<tr><td>layouts</td><td>Array of tilelayouts</td><td>See <a href="nml-language.html#block-tilelayout">Tilelayout</a> syntax.</td></tr>
<tr><td>prod_flags</td><td>One of PRODUCTIONTYPE_EXTRACTIVE, PRODUCTIONTYPE_ORGANIC or PRODUCTIONTYPE_PROCESSING</td><td>Type of industry</td></tr>
<tr><td>closure_msg</td><td>string</td><td>Message displayed when the industry announces closure.</td></tr>
<tr><td>prod_increase_msg</td><td>string</td><td>Message displayed when industry increases production.</td></tr>
<tr><td>prod_decrease_msg</td><td>string</td><td>Message displayed when industry decreases production.</td></tr>
<tr><td>fund_cost_multiplier</td><td>0..255</td><td>Fund cost multiplier</td></tr>
<tr><td>prod_cargo_types</td><td>array up to 2 ints</td><td>Types of cargo produced.</td></tr>
<tr><td>accept_cargo_types</td> <td>array uo to 3 ints</td><td>Types of cargo accepted.</td></tr>
<tr><td>prod_multiplier_1</td><td>0..255</td><td>Amount of cargo 1 produced every 256 ticks (8 or 9 times a month)</td></tr>
<tr><td>prod_multiplier_2</td><td>0..255</td><td>Amount of cargo 2 produced every 256 ticks (8 or 9 times a month)</td></tr>
<tr><td>min_cargo_distr</td><td>0..255</td><td>Minimal amount of cargo before transporting to stations.</td></tr>
<tr><td>random_sound_effects</td><td>array of ints</td><td>Sound effect numbers that are played some times.</td></tr>
<tr><td>conflicting_ind_types</td><td>array of 3 ints</td><td>Three industry types that should not be nearby.</td></tr>
<tr><td>prob_random</td><td>0..10</td><td>Probability of occurring while generating initial industries.</td></tr>
<tr><td>prob_in_game</td><td>0..10</td><td>Probability of occurring while creating industries during the game.</td></tr>
<tr><td>map_colour</td><td>0..255</td><td>Colour of the industry at the mini map.</td></tr>
<tr><td>spec_flags</td><td>bitmask(flags)</td><td>for flag values see <a href="#industry-special-flags">Industry special flags</a></td></tr>
<tr><td>new_ind_text</td><td>string</td><td>Message displayed when industry gets built during game play.</td></tr>
<tr><td>input_multiplier_1</td><td>array of 2 floats (0..255)</td><td>Output cargo multiplication factors for getting a unit of the first accepted cargo.</td></tr>
<tr><td>input_multiplier_2</td><td>array of 2 floats (0..255)</td><td>Output cargo multiplication factors for getting a unit of the second accepted cargo.</td></tr>
<tr><td>input_multiplier_3</td><td>array of 2 floats (0..255)</td><td>Output cargo multiplication factors for getting a unit of the third accepted cargo.</td></tr>
<tr><td>name</td><td>string</td><td>Name of the industry</td></tr>
<tr><td>prospect_chance</td><td>Fraction between 0 and 1</td><td>Chance of successful prospecting.</td></tr>
<tr><td>callback_flags</td><td>bitmask(flags)</td><td>for flag values see <a href="#industry-callback-flags">Industry callback flags</a></td></tr>
<tr><td>remove_cost_multiplier</td><td>int</td><td>multiplier for removing the industry.</td></tr>
<tr><td>nearby_station_name</td><td>string</td><td>Default additional name for a nearby station</td></tr>
</table>

<h3><a name="industry-callback-flags">Industry callback flags</a></h3>
<table class="t">
<tr><th>flag</th><th>meaning</th></tr>
<tr><td>IND_CBF_AVAILABILITY</td><td></td></tr>
<tr><td>IND_CBF_PROD_CB_CARGO_ARRIVE</td><td></td></tr>
<tr><td>IND_CBF_PROD_CB_256_TICKS</td><td></td></tr>
<tr><td>IND_CBF_LOCATION_CHECK</td><td></td></tr>
<tr><td>IND_CBF_RANDOM_PROD_CHANGE</td><td></td></tr>
<tr><td>IND_CBF_MONTLY_PROD_CHANGE</td><td></td></tr>
<tr><td>IND_CBF_CARGO_SUBTYPE_DISPLAY</td><td></td></tr>
<tr><td>IND_CBF_EXTRA_TEXT_FUND</td><td></td></tr>
<tr><td>IND_CBF_EXTRA_TEXT_INDUSTRY</td><td></td></tr>
<tr><td>IND_CBF_CONTROL_SPECIAL</td><td></td></tr>
<tr><td>IND_CBF_STOP_ACCEPT_CARGO</td><td></td></tr>
<tr><td>IND_CBF_COLOUR</td><td></td></tr>
<tr><td>IND_CBF_CARGO_INPUT</td><td></td></tr>
<tr><td>IND_CBF_CARGO_OUTPUT</td><td></td></tr>
</table>

<h3><a name="industry-special-flags">Industry special flags</a></h3>
<table class="t">
<tr><th>flag</th><th>meaning</th></tr>
<tr><td>IND_FLAG_PLANT_FIELDS_PERIODICALLY</td><td>The industry periodically plants fields around itself (temperate and arctic farms) </td></tr>
<tr><td>IND_FLAG_CUT_TREES</td><td>The industry cuts trees around itself and produces its first output cargo from them (lumber mill) </td></tr>
<tr><td>IND_FLAG_BUILT_ON_WATER</td><td>The industry is built on water (oil rig) </td></tr>
<tr><td>IND_FLAG_ONLY_IN_LARGE_TOWNS</td><td>The industry can only be built in towns (i.e. it has to replace houses) with population larger than 1200 (temperate bank) </td></tr>
<tr><td>IND_FLAG_ONLY_IN_TOWNS</td><td>The industry can only be built in towns (i.e. it has to replace houses) (arctic and tropic banks, water tower) </td></tr>
<tr><td>IND_FLAG_BUILT_NEAR_TOWN</td><td>The industry is always built near towns (i.e. near town sign; additionally the industry is allowed to replace houses) (toy shop) </td></tr>
<tr><td>IND_FLAG_PLANT_FIELDS_WHEN_BUILT</td><td>Fields are planted around the industry when it's built (all farms) </td></tr>
<tr><td>IND_FLAG_NO_PRODUCTION_INCREASE</td><td>The industry cannot increase its production on the temperate climate (oil wells) </td></tr>
<tr><td>IND_FLAG_BUILT_ONLY_BEFORE_1950</td><td>The industry is built only before 1950 (oil wells) </td></tr>
<tr><td>IND_FLAG_BUILT_ONLY_AFTER_1960</td><td>The industry is built only after 1960 (oil rig) </td></tr>
<tr><td>IND_FLAG_AI_CREATES_AIR_AND_SHIP_ROUTES</td><td>AI players will attempt to establish air and ship routes going to this industry (oil rig) </td></tr>
<tr><td>IND_FLAG_MILITARY_AIRPLANE_CAN_EXPLODE</td><td>The industry can be exploded by a military airplane (oil refinery) </td></tr>
<tr><td>IND_FLAG_MILITARY_HELICOPTER_CAN_EXPLODE</td><td>The industry can be exploded by a military helicopter (factory) </td></tr>
<tr><td>IND_FLAG_CAN_CAUSE_SUBSIDENCE</td><td>The industry can cause a subsidence (coal mine) </td></tr>
<tr><td>IND_FLAG_AUTOMATIC_PRODUCTION_MULTIPLIER</td><td>Automatic production multiplier handing (No industry has this bit set by default.). </td></tr>
<tr><td>IND_FLAG_RANDOM_BITS_IN_PRODUCTION_CALLBACK</td><td>The production callback needs random bits in var. 10 (No industry has this bit set by default.) </td></tr>
<tr><td>IND_FLAG_DO_NOT_FORCE_INSTANCE_AT_MAP_GENERATION</td><td>Do not force one instance of this type to appear during initial map generation (No industry has this bit set by default.) </td></tr>
<tr><td>IND_FLAG_ALLOW_CLOSING_LAST_INSTANCE</td><td>Allow closing down the last instance of this type (No industry has this bit set by default.)</td></tr>
</table>

</body>
</html>

