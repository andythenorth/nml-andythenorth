<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>NML documentation</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<link rel="stylesheet" title="Standard Style" type="text/css" href="nml.css">
</head>
<body>

<h1><a name="industries">Industries and industry tiles</a></h1>

<h2><a name="industries-property">Industry properties</a></h2>
Industry properties.
Default industry type numbers can be found at <a href="refs.html#refs-default-industries">default industries</a>.
<p>
<table class="t">
<tr><th>property</th><th>value range</th><th>comment</th></tr>
<tr><td>substitute</td><td>industry type</td><td>Number of the original industry type that replaces this one, should it not be available for some reason (e.g. missing NewGRF).
This <em>must</em> be the first property to be set, before any other properties or graphics. All properties of the old type are copied to your new industry.</td></tr>
<tr><td>override</td><td>industry type</td><td>Number of the original industry type overridden. This will cause other grfs / industries to consider your industry type the same as the old type. Only set this property if your type is (more or less) the same as the old type.</td></tr>
<tr><td>layouts</td><td>Array of tilelayouts</td><td>See <a href="nml-language.html#block-tilelayout">Tilelayout</a> syntax.</td></tr>
<tr><td>life_type</td><td>One of IND_LIFE_TYPE_XXX, XXX = BLACK_HOLE | EXTRACTIVE | ORGANIC | PROCESSING</td><td>The generic type of industry. This determines the production
changes that occur by default (when not using the callback). Examples are respectively power plants, coal mines, forests en steel mills.</td></tr>
<tr><td>closure_msg</td><td>string</td><td>Message displayed when the industry announces closure.</td></tr>
<tr><td>prod_increase_msg</td><td>string</td><td>Message displayed when industry increases production.</td></tr>
<tr><td>prod_decrease_msg</td><td>string</td><td>Message displayed when industry decreases production.</td></tr>
<tr><td>fund_cost_multiplier</td><td>0..255</td><td>Fund cost multiplier. Note that in OpenTTD the unmodified base cost is 8x higher for building (not prospecting) raw (=extractive / organic, see life_type) industries.</td></tr>
<tr><td>prod_cargo_types</td><td>array of up to 2 ints</td><td>Types of cargo produced. Use the cargotype(&lt;label&gt;) built-in function to specify a label from the cargotable.</td></tr>
<tr><td>accept_cargo_types</td> <td>array of up to 3 ints</td><td>Types of cargo accepted. Use the cargotype(&lt;label&gt;) built-in function to specify a label from the cargotable</td></tr>
<tr><td>prod_multiplier</td><td>array of up to 2 ints (0..255)</td><td>Amount of each output cargo to produce every 256 ticks (8 or 9 times a month)</td></tr>
<tr><td>min_cargo_distr</td><td>0..255</td><td>Minimal amount of cargo before transporting to stations.</td></tr>
<tr><td>random_sound_effects</td><td>array of ints</td><td>Sound effect numbers that are played some times.</td></tr>
<tr><td>conflicting_ind_types</td><td>array of up to 3x industry_type(IND_TYPE_OLD | IND_TYPE_NEW, id)</td><td>Three industry types that should not be nearby.
Use the <a href="nml-language.html#builtin-functions">builtin function</a> <code>industry_type(..)</code>
to define either an old industry (using the global ID) or a new industry from your grf (using the grf-local ID).</td></tr>
<tr><td>prob_random</td><td>0..10</td><td>Probability of occurring while generating initial industries.</td></tr>
<tr><td>prob_in_game</td><td>0..10</td><td>Probability of occurring while creating industries during the game.</td></tr>
<tr><td>map_colour</td><td>0..255</td><td>Colour index from the <a href="nml-language.html#graphic-files">DOS palette</a> to use on the minimap for this industry.</td></tr>
<tr><td>spec_flags</td><td>bitmask(flags)</td><td>for flag values see <a href="#industry-special-flags">Industry special flags</a></td></tr>
<tr><td>new_ind_msg</td><td>string</td><td>Message displayed when industry gets built during game play.</td></tr>
<tr><td>input_multiplier_1</td><td>array of up to 2 floats (0..255)</td><td>Output cargo multiplication factors for getting a unit of the first accepted cargo.</td></tr>
<tr><td>input_multiplier_2</td><td>array of up to 2 floats (0..255)</td><td>Output cargo multiplication factors for getting a unit of the second accepted cargo.</td></tr>
<tr><td>input_multiplier_3</td><td>array of up to 2 floats (0..255)</td><td>Output cargo multiplication factors for getting a unit of the third accepted cargo.</td></tr>
<tr><td>name</td><td>string</td><td>Name of the industry</td></tr>
<tr><td>prospect_chance</td><td>Fraction between 0 and 1</td><td>Chance of successful prospecting.</td></tr>
<tr><td>callback_flags</td><td>bitmask(flags)</td><td>Do not set this, unless you use <a href="old-callbacks.html#old-callbacks-industries">old-style callbacks</a>.
<tr><td>remove_cost_multiplier</td><td>int</td><td>Cost multiplier for removing the industry (currently only possible with magic bulldozer).</td></tr>
<tr><td>nearby_station_name</td><td>string</td><td>Default additional name for a nearby station</td></tr>
</table>

<h3><a name="industry-special-flags">Industry special flags</a></h3>
<table class="t">
<tr><th>flag</th><th>meaning</th></tr>
<tr><td>IND_FLAG_PLANT_FIELDS_PERIODICALLY</td><td>The industry periodically plants fields around itself (temperate and arctic farms) </td></tr>
<tr><td>IND_FLAG_CUT_TREES</td><td>The industry cuts trees around itself and produces its first output cargo from them (lumber mill) </td></tr>
<tr><td>IND_FLAG_BUILT_ON_WATER</td><td>The industry is built on water (oil rig) </td></tr>
<tr><td>IND_FLAG_ONLY_IN_LARGE_TOWNS</td><td>The industry can only be built in towns (i.e. it has to replace houses) with population larger than 1200 (temperate bank) </td></tr>
<tr><td>IND_FLAG_ONLY_IN_TOWNS</td><td>The industry can only be built in towns (i.e. it has to replace houses) (arctic and tropic banks, water tower) </td></tr>
<tr><td>IND_FLAG_BUILT_NEAR_TOWN</td><td>The industry is always built near towns (i.e. near town sign; additionally the industry is allowed to replace houses) (toy shop) </td></tr>
<tr><td>IND_FLAG_PLANT_FIELDS_WHEN_BUILT</td><td>Fields are planted around the industry when it's built (all farms) </td></tr>
<tr><td>IND_FLAG_NO_PRODUCTION_INCREASE</td><td>The industry cannot increase its production on the temperate climate (oil wells) </td></tr>
<tr><td>IND_FLAG_BUILT_ONLY_BEFORE_1950</td><td>The industry is built only before 1950 (oil wells) </td></tr>
<tr><td>IND_FLAG_BUILT_ONLY_AFTER_1960</td><td>The industry is built only after 1960 (oil rig) </td></tr>
<tr><td>IND_FLAG_AI_CREATES_AIR_AND_SHIP_ROUTES</td><td>AI players will attempt to establish air and ship routes going to this industry (oil rig) </td></tr>
<tr><td>IND_FLAG_MILITARY_AIRPLANE_CAN_EXPLODE</td><td>The industry can be exploded by a military airplane (oil refinery) </td></tr>
<tr><td>IND_FLAG_MILITARY_HELICOPTER_CAN_EXPLODE</td><td>The industry can be exploded by a military helicopter (factory) </td></tr>
<tr><td>IND_FLAG_CAN_CAUSE_SUBSIDENCE</td><td>The industry can cause a subsidence (coal mine) </td></tr>
<tr><td>IND_FLAG_AUTOMATIC_PRODUCTION_MULTIPLIER</td><td>Automatic production multiplier handing (No industry has this bit set by default.). </td></tr>
<tr><td>IND_FLAG_RANDOM_BITS_IN_PRODUCTION_CALLBACK</td><td>The production callback needs random bits in var. 10 (No industry has this bit set by default.) </td></tr>
<tr><td>IND_FLAG_DO_NOT_FORCE_INSTANCE_AT_MAP_GENERATION</td><td>Do not force one instance of this type to appear during initial map generation (No industry has this bit set by default.) </td></tr>
<tr><td>IND_FLAG_ALLOW_CLOSING_LAST_INSTANCE</td><td>Allow closing down the last instance of this type (No industry has this bit set by default.)</td></tr>
</table>

<h2><a name="industrytiles-property">Industry tile properties</a></h2>
<table class="t">
<tr><th>property</th><th>value range</th><th>comment</th></tr>
<tr><td>substitute</td><td><a href="refs.html#refs-default-industrytiles">0..174</a></td><td>Number of the default industry tile that replaces this one, if this industry tile is not available for some reason.
This property <em>must</em> be set first, before any other properties or graphics. All properties of the old type are copied to your new house.
<tr><td>override</td><td><a href="refs.html#refs-default-industrytiles">0..174</a></td><td>id of the default industry tile which this industry tile replaces. This will cause your industry tile to be placed instead of the default industry tile.
This is ignored, if the default industry tile has already been overridden. You can define this property multiple times
<tr><td>accepted_cargos</td><td>Array with up to 3 [cargo_id, amount]-pairs.</td><td>The cargos that are accepted by this tile. CargoID is a cargo type from 
your cargo translation table, amount is the acceptance of the given cargo in 1/8 units.<br>
Example: to make a tile accept both COAL and IORE you could use this: <code>accepted_cargos: [[COAL, 8], [IORE, 8]];</code><br>
Example: for a tile that doesn't any cargos at all you'd use: <code>accepted_cargos: [];</code></td></tr>
<tr><td>land_shape_flags</td><td>bitmask(<a href="#land-shape-flags">Land shape flags</a>)</td><td></td></tr>
<tr><td>callback_flags</td><td>bitmask(INDTILE_CBF_XXX, INDTILE_CBF_YYY)</td><td>Do not set this, unless you use <a href="old-callbacks.html#old-callbacks-industrytiles">old-style callbacks</a>.
| CARGO_TYPE_ACCEPT | SLOPE_IS_SUITABLE | FOUNDATIONS | AUTOSLOPE</td></tr>
<tr><td>animation_info</td><td>Array [ANIMATION_XXX, frame-count]</td><td>XXX = [LOOPING | NON_LOOPING], 1..253 frames</td></tr>
<tr><td>animation_speed</td><td>0..16</td><td>Speed of animation, see <a href="refs.html#refs-animation-speed-values">animation speed table</a> for the meaning of the values.</td></tr>
<tr><td>animation_triggers</td><td>bitmask(ANIM_TRIGGER_INDTILE_XXX, ... )</td><td>Bitmask of
triggers that will trigger the <code>anim_control</code> callback,
see the <a href="#industrytiles-callbacks-animtriggers">table</a> below.</td></tr>
<tr><td>special_flags</td><td>0..1</td><td>Set to 1 if INDTILE_CB_ANIM_NEXT_FRAME needs random bits</td></tr>
</table>

<h3><a name="land-shape-flags">Land shape flags</a></h3>
<table class="t">
<tr><th>Flag</th><th>Meaning</th></tr>
<tr><td>LSF_CANNOT_LOWER_NW_EDGE</td><td>North-west edge cannot be lowered</td></tr>
<tr><td>LSF_CANNOT_LOWER_NE_EDGE</td><td>North-east edge cannot be lowered</td></tr>
<tr><td>LSF_CANNOT_LOWER_SW_EDGE</td><td>South-west edge cannot be lowered</td></tr>
<tr><td>LSF_CANNOT_LOWER_SE_EDGE</td><td>South-east edge cannot be lowered</td></tr>
<tr><td>LSF_ONLY_ON_FLAT_LAND</td><td>This tile can only be built on flat land</td></tr>
<tr><td>LSF_ALLOW_ON_WATER</td><td>The land/water check is disabled for this tile so it can be built on water. If you need
more control over this use callback 0x2F.</td></tr>
</table>

<h2><a name="industries-vars-common">Common variables</a></h2>
<p>The following variables are available to both industries and industry tiles.
All of them require an x, y offset. For industries, this offset is unsigned and
relative to the northernmost tile. For industry tiles, it is signed and relative
to the current tile.</p>
<table class="t">
<tr><th>name</th><th>value range</th><th>comment</th></tr>
<tr><td>nearby_tile_slope</td><td>Which corners are raised on the given tile.</td><td>
Bit 0: west corner is above the lowest corner.<br>
Bit 1: south corner is above the lowest corner.<br>
Bit 2: east corner is above the lowest corner.<br>
Bit 3: north corner is above the lowest corner.<br>
Bit 4: this tile is a steep slope (the corner opposite to the lowest corner is 2 units higher).<br>
See <a href="refs.html#refs-slopes">tile slopes</a> for an illustration
</td></tr>
<tr><td>nearby_tile_is_water</td><td>1 if the tile is water, 0 otherwise</td><td></td></tr>
<tr><td>nearby_tile_terrain_type</td><td>TILETYPE_XX</td><td>TILETYPE_NORMAL, TILETYPE_DESERT, TILETYPE_RAIN_FOREST, TILETYPE_SNOW</td></tr>
<tr><td>nearby_tile_water_class</td><td>WATER_CLASS_XXX</td> <td>XXX = [NONE | SEA | CANAL | RIVER]
Note that tiles for which <code>nearby_tile_is_water</code> is 0 may still have a water class, e.g. industry tiles with water beneath them.</td></tr>
<tr><td>nearby_tile_height</td><td>0..120</td><td>The height of the lowest corner of the given tile.</td></tr>
<tr><td>nearby_tile_class</td><td><a href="refs.html#refs-tile-classes">Tile class</a></td><td></td></tr>
<tr><td>nearby_tile_animation_frame</td><td>0..255</td><td>Animation frame of the given tile</td></tr>
<tr><td>nearby_tile_industrytile_id</td><td>0x00aa, 0xFFbb, 0xFFFE or 0xFFFF</td><td>
0x00aa: The tile is an industry tile that is part of this GRF, the tile id is aa.<br>
0xFFbb: The tile is an original industry tile with id bb.<br>
0xFFFE: The tile is an industry tile defined in another GRF.<br>
0xFFFF: The tile is not an industry tile or it belongs to another GRF.
</td></tr>
</table>

<h2><a name="industries-vars">Industry variables</a></h2>
<table class="t">
<tr><th>name</th><th>value range</th><th>comment</th></tr>
<tr><td>waiting_cargo_1</td><td>0..65535</td><td>If any of the production callbacks is enabled, this variable will contain the amount of the first cargo type awaiting to be processed.</td></tr>
<tr><td>waiting_cargo_2</td><td>0..65535</td><td>If any of the production callbacks is enabled, this variable will contain the amount of the second cargo type awaiting to be processed.</td></tr>
<tr><td>waiting_cargo_3</td><td>0..65535</td><td>If any of the production callbacks is enabled, this variable will contain the amount of the third cargo type awaiting to be processed.</td></tr>
<tr><td>produced_last_month_1</td><td>0..65535</td><td>The amount of 'output cargo type 1' that was produced last month.</td></tr>
<tr><td>produced_last_month_2</td><td>0..65535</td><td>The amount of 'output cargo type 2' that was produced last month.</td></tr>
<tr><td>water_distance</td><td>Distance to the tile</td><td>If the industry is built on water, this variable gives the distance of the closest dry land tile, otherwise it gives the distance of the closest water tile.</td></tr>
<tr><td>layout_num</td><td>1..255</td><td>Number of the layout being used by the industry.</td></tr>
<tr><td>founder</td><td>0..16</td><td>Company number of the industry founder. It will be 16 (0x10) if the industry was generated randomly. TTDPatch only supports up to 8 companies (0..7).</td></tr>
<tr><td>founder_type</td><td>PLAYERTYPE_XX</td><td>PLAYERTYPE_HUMAN, PLAYERTYPE_AI, PLAYERTYPE_HUMAN_IN_AI (human managing AI company) or PLAYERTYPE_AI_IN_HUMAN (AI managing human company). OpenTTD only uses PLAYERTYPE_HUMAN and PLAYERTYPE_AI. If you cheat yourself to be part of an AI company OpenTTD will still report PLAYERTYPE_AI for the company with yourself and the AI and it'll report PLAYERTYPE_HUMAN for the now uncontrolled company.</td></tr>
<tr><td>founder_colour1</td><td>0..15</td><td>Index of founding company's first colour. 0 if not founded by a company.</td></tr>
<tr><td>founder_colour2</td><td>0..15</td><td>Index of founding company's second colour. It's the same as company_colour1, if no second company colour is chosen. 0 if not founded by a company.</td></tr>
<tr><td>colour</td><td>0..15</td><td>Random colour for this industry.</td></tr>
<tr><td>build_date</td><td>0..1826212865</td><td>Date of the industry foundation in days since year 0.</td></tr>
<tr><td>build_type</td><td>BUILDTYPE_XX</td><td>BUILDTYPE_UNKNOWN (if created in an old version or with newindustries disabled), BUILDTYPE_GAMEPLAY (if founded or created by the in-game random industry generator), BUILDTYPE_GENERATION (if created during random map generation) or BUILDTYPE_EDITOR (if created with the scenario editor).</td></tr>
<tr><td>counter</td><td>0..65535</td><td>Decremented every tick, used to time primary industry production in TTD.</td></tr>
</table><br>
Variables that require some parameters.
<table class="t">
<tr><th>name</th><th>arguments</th><th>comment</th></tr>
<tr><td>industry_count</td><td>industry_type, grfid&nbsp;=&nbsp;-1</td><td>The value of this variable is the number
of industries of a given type that are currently on the map. industry_type is either the ID of an
industry. GRFid is the grf in which the industry was defined. The default value is -1, which means
current newgrf. A grfid of 0 lets you check the number of default industries of a given type.
Use the <a href="nml-language.html#builtin-functions">builtin function</a> <code>str2number()</code>
to convert a grfid to its numeric representation.<br/>
<i>Warning: using this variable trashes the contents of temporary storage register 0x100</i></td></tr>
<tr><td>industry_distance</td><td>industry_type, grfid&nbsp;=&nbsp;-1</td><td>The value of this variable is the
manhattan distance the closest instance of the given industry or 0xFFFF if not applicable. See
industry_count for a description of the parameters.<br/>
<i>Warning: using this variable trashes the contents of temporary storage register 0x100.</i></td></tr>
<tr><td>industry_layout_count / industry_layout_distance</td><td>industry_type, layout, grfid&nbsp;=&nbsp;-1.</td>
<td>See industry_count / industry_distance for description of industry_type, grfid and return value. The
results are filtered to industries that have the given layout number.<br/>
<i>Warning: using this variable trashes the contents of temporary storage registers 0x100 and 0x101.</i></td></tr>
<tr><td>industry_town_count</td><td>industry_type, grfid&nbsp;=&nbsp;-1.</td>
<td>See industry_count / industry_distance for description of industry_type, grfid and return value. The
results are filtered to industries that have the same town than the current industry.<br/>
<i>Warning: using this variable trashes the contents of temporary storage registers 0x100 and 0x101.</i></td></tr>
<tr><td>town_manhattan_dist</td><td>x, y</td><td>Parameters indicate a signed offset relative to the northern tile.
Returns the Manhattan distance (dx + dy) from the selected tile to the closest town</td></tr>
<tr><td>town_euclidean_dist</td><td>x, y</td><td>Parameters indicate a signed offset relative to the northern tile.
Returns the squared Eucleidean distance (dx^2 + dy^2) from the selected tile to the closest town.</td></tr>
<tr><td>town_zone</td><td>x, y</td><td>Parameters indicate a signed offset relative to the northern tile.
Returns the <a href="refs.html#refs-town-zones">town zone</a> that the selected tile is in.</td></tr>
<tr><td>nearby_tile_random_bits</td><td>x, y</td><td>Parameters indicate an unsigned offset relative to the northern tile.
Returns the random bits of the selected industry tile, or 0 if it is not an industry tile that's part of this industry.</td></tr>
</table>

<h2><a name="industrytiles-vars">Industry tile variables</a></h2>
<table class="t">
<tr><th>name</th><th>value range</th><th>comment</th></tr>
<tr><td>construction_state</td><td>0..3</td><td>Current construction state of the industry tile.</td></tr>
<tr><td>terrain_type</td><td>TILETYPE_XX</td><td>TILETYPE_NORMAL, TILETYPE_DESERT, TILETYPE_RAIN_FOREST, TILETYPE_SNOW</td></tr>
<tr><td>town_zone</td><td><a href="refs.html#refs-town-zones">town zone</a></td><td>The town zone of the current tile.</td></tr>
<tr><td>relative_x</td><td>0..255</td><td>X-coordinate (top right -> bottom left) of the tile relative to the northernmost tile.</td></tr>
<tr><td>relative_y</td><td>0..255</td><td>Y-coordinate (top left -> bottom right) of the tile relative to the northernmost tile.</td></tr>
<tr><td>relative_pos</td><td>0xYYXX</td><td>A combination of relative_x and relative_y in the format 0xYYXX. Useful if you want to check for a single position.</td></tr>
<tr><td>animation_frame</td><td>0..255</td><td>Current animation frame.</td></tr>
</table><br>
<p>Industry tiles have access to the <a href="#industries-vars-common">common variables</a>
described above. Additionally, they have access to the following:</p>
<table class="t">
<tr><th>name</th><th>arguments</th><th>comment</th></tr>
<tr><td>nearby_tile_is_same_industry</td><td>x, y</td><td>Parameters indicate a signed tile offset relative to the current tile.
Returns 1 if the tile is part of the same industry, 0 otherwise</td></tr>
</table>

<h2><a name="industries-callbacks">Industry callbacks</a></h2>

<table class="t">
<tr><th>callback<th>return value<th>comment
<tr><td>default<td>varies<td>Any unhandled callbacks. Generally this doesn't
need to be used, except for old-style callbacks.
<tr><td>produce_cargo_arrival<td>Produce-block<td>Called to produce cargo when it arrives.
<tr><td>produce_256_ticks<td>Produce-block<td>Called to produce cargo every 256 ticks.
<tr><td>availability<td>CB_RESULT_IND_ALLOW or CB_RESULT_IND_DISALLOW<td>Called when
the game needs to know if the industry type is available. It is limited to the type as
a whole, so you can't access industry-specific variables. <code>extra_callback_info2</code>
contains the <a href="#industries-callbacks-creation-types">creation type</a>.
<tr><td>location_check<td>See the <a href="#industries-callbacks-location-check-results">table</a> below.
<td>Called to check if a location is suitable. <code>extra_callback_info2</code>
contains the <a href="#industries-callbacks-creation-types">creation type</a>.
Since the industry isn't built yet, industry variables aren't available.
<tr><td>monthly_prod_change<td>See <a href="#industries-callbacks-production-changes">below</a>
<td>Called each month to (possibly) change the industry production.
<code>extra_callback_info2</code> contains random bits.
<tr><td>random_prod_change<td>See <a href="#industries-callbacks-production-changes">below</a>
<td>Works exactly the same as <code>monthly_prod_change</code>,
except that it's only called when TTD selects this industry for a random production change.
<tr><td>cargo_subtype_display<td>String or 0xFF<td>This callback allows displaying
some text after a cargo name. Returning 0xFF displays nothing.
The lowest byte of <code>extra_callback_info2</code> contains 0 .. 2 to get texts
for the first .. third accepted cargo type, and 3 .. 4 for the first ... second
produced cargo type. The second byte contains 0 when getting a string for the buy
menu (no industry variables available!), 1 when for the industry window and 2 for the
industry directory window.
<tr><td>extra_text_industry<td>String<td>Show extra text in the industry
window.
<tr><td>extra_text_fund<td>String<td>Show extra text in the fund window.
Since the industry isn't built, no industry variables are available.
<tr><td>control_special<td>0 or 1<td>Called to control various
effects from the <code>spec_flags</code> property. Currently only works for the
first two (plant fields / cut trees). Return 1 to execute the action or 0 to not
do so. The relevant flag is given in <code>extra_callback_info2</code>.
The default (if the flag is enabled, of course) is to plant fields with
1/8th chance every 256 ticks, and to cut trees every 512 ticks.
Random bits are supplied in <code>extra_callback_info1</code>.
<tr><td>stop_accept_cargo<td>0 or 1<td>With this callback, you can temporarily
refuse accepting a certain cargo, for example because the stockpile is full.
Return 1 to accept or 0 to refuse. Make sure to synchronize this callback with
the <code>cargo_amount_accept</code> callback for industry tiles.
<code>extra_callback_info2</code> contains the cargo type to accept or not.
<tr><td>colour<td>0 .. 15<td>Called after constructing the industry. The
<code>colour</code> variable is set to a random value at this point, you can
use this callback to change this.
<tr><td>cargo_input<td>Cargo type, or 0xFF<td>Decide the input cargo types.
Called repeatedly until 0xFF is returned, although currently not more
than three times. Do not rely on this limitation, though.
<code>extra_callback_info1</code> starts at 0 and is incremented for every
iteration. Return a cargo type (from the table) or 0xFF to stop.
<tr><td>cargo_output<td>Cargo type, or 0xFF<td>Same as <code>cargo_input</code>
above, except that it is applied to the output cargo types and currently not
called more than twice.
</table>

<h3><a name="industries-callbacks-location-check-results">Location check results</a></h3>
<table class="t">
<tr><th>return value<th>meaning
<tr><td>String<td>Industry can't be built, show the string as error message.
<tr><td>CB_RESULT_IND_ALLOW_LOCATION<td>Industry can be built.
<tr><td>CB_RESULT_IND_DISALLOW_UNSUITABLE<td>Industry can't be built, display the default "site unsuitable" error message.
<tr><td>CB_RESULT_IND_DISALLOW_ONLY_RAINFOREST<td>Industry can't be built, display the "...can only be built in rainforest areas" error message.
<tr><td>CB_RESULT_IND_DISALLOW_ONLY_DESERT<td>Industry can't be built, display the "...can only be built in desert areas" error message.
<tr><td>CB_RESULT_IND_DISALLOW_ONLY_ABOVE_SNOWLINE<td>Industry can't be built, display the "...can only be built above the snow-line" error message.
<tr><td>CB_RESULT_IND_DISALLOW_ONLY_BELOW_SNOWLINE<td>Industry can't be built, display the "...can only be built below the snow-line" error message.
<tr><td>CB_RESULT_IND_DISALLOW_NOT_ON_OPEN_SEA<td>Industry can't be built, display the "...can't build on open sea" error message.
<tr><td>CB_RESULT_IND_DISALLOW_NOT_ON_CANAL<td>Industry can't be built, display the "...can't build on canal" error message
<tr><td>CB_RESULT_IND_DISALLOW_NOT_ON_RIVER<td>Industry can't be built, display the "...can't build on river" error message. 
</table>

<h3><a name="industries-callbacks-production-changes">Production change callback results</a></h3>
<table class="t">
<tr><th>value<th>meaning
<tr><td>CB_RESULT_IND_PROD_NO_CHANGE<td>Do not change industry production
<tr><td>CB_RESULT_IND_PROD_HALF<td>Half industry production. If production
goes below a quarter of default, the industry closes.
<tr><td>CB_RESULT_IND_PROD_DOUBLE<td>Double production if it's not 8x default yet.
<tr><td>CB_RESULT_IND_PROD_CLOSE<td>Announce closoure and remove the industry next month.
<tr><td>CB_RESULT_IND_PROD_RANDOM<td>Do a random production change, as if the industry
is a primary one.
<tr><td>CB_RESULT_IND_PROD_DIVIDE_BY_4<td>Divide production by 4
<tr><td>CB_RESULT_IND_PROD_DIVIDE_BY_8<td>Divide production by 8
<tr><td>CB_RESULT_IND_PROD_DIVIDE_BY_16<td>Divide production by 16
<tr><td>CB_RESULT_IND_PROD_DIVIDE_BY_32<td>Divide production by 32
<tr><td>CB_RESULT_IND_PROD_MULTIPLY_BY_4<td>Multiply production by 4
<tr><td>CB_RESULT_IND_PROD_MULTIPLY_BY_8<td>Multiply production by 8
<tr><td>CB_RESULT_IND_PROD_MULTIPLY_BY_16<td>Multiply production by 16
<tr><td>CB_RESULT_IND_PROD_MULTIPLY_BY_32<td>Multiply production by 32
<tr><td>CB_RESULT_IND_PROD_DECREMENT_BY_1<td>Decrement production by 1
<tr><td>CB_RESULT_IND_PROD_INCREMENT_BY_1<td>Increment production by 1
<tr><td>CB_RESULT_IND_PROD_SET_BY_0x100<td>Set the production level to the
value in bits 16 .. 23 of register 0x100.
</table>
<p>Setting bit 7 of the result disables the associated news message.<br>
Setting bit 8 replaces the news message with a custom message, read from
register 0x100 bits 0 .. 15.</p>

<h3><a name="industries-callbacks-creation-types">Industry creation types</a></h3>
<table class="t">
<tr><th>value<th>meaning
<tr><td>IND_CREATION_GENERATION<td>Industry is created during map generation
<tr><td>IND_CREATION_RANDOM<td>Industry is randomly generated during gameplay
<tr><td>IND_CREATION_FUND<td>Industry is funded by the player
<tr><td>IND_CREATION_PROSPECT<td>Industry is prospected by the player
</table>

<h2><a name="industrytiles-callbacks">Industry tile callbacks</a></h2>
<table class="t">
<tr><th>callback<th>return value<th>comment
<tr><td>default<td>Sprite layout<td>Graphics for the industry tile
<tr><td>random_trigger<td>N/A<td>See <a href="nml-language.html#block-randomswitch">
random switch</a> for more information.
<tr><td>anim_next_frame<td>Next animation frame or CB_RESULT_XXX<td>Called for
every animation frame, returns the next frame to display. Alternatively,
return CB_RESULT_NEXT_FRAME or CB_RESULT_STOP_ANIMATION to show the next frame
or stop animation, respectively. <code>extra_callback_info1</code> contains
random bits, if enabled in the <code>special_flags</code> property. Returning a
sound effect in the high byte will cause that sound effect to be played.
<tr><td>anim_control<td>Next animation frame or CB_RESULT_XXX<td>Called whenever
an animation trigger happens. Return the animation frame to show, or
CB_RESULT_XXX with XXX = [CB_RESULT_START_ANIMATION | STOP_ANIMATION | DO_NOTHING]
to respectively start the animation in its current frame, stop the animation or
do nothing. <code>extra_callback_info1</code> contains random bits, if enabled
in the <code>special_flags</code> property.  Returning a sound effect in the
high byte will cause that sound effect to be played.
<code>extra_callback_info2</code> contains the reason to trigger the animation,
see the <a href="#industrytiles-callbacks-animtriggers">table</a> below. Note
that you need to enable the wanted triggers in the <code>animation_triggers</code>
property.
<tr><td>anim_speed<td>0 .. 16<td>Decide the time an animation frame should last.
Return value is interpreted as (num_ticks = 2^anim_speed), which each tick lasting
30 ms. Avoid using this callback if possible, since it has to be called each tick
for every animated tile. This can be used to create animation frames that last
between 30 ms and 33 minutes.
<tr><td>cargo_type_accept<td>type1 + (type2 &lt;&lt; 5) + (type3 &lt;&lt; 10)<td>
Decide the cargo types that this tile accepts. If this callback is not
implemented or fails, the values from <code>accepted_cargos</code> are used instead.
Bits 0..4: First cargo type. Bits 5..9: Second cargo type. Bits 10..14: Third cargo type.
<tr><td>cargo_amount_accept<td>amt1 + (amt2 &lt;&lt; 4) + (amt3 &lt;&lt; 8)<td>
Acceptance for each cargo amount in 1/8th. If this callback is not
implemented or fails, the values from <code>accepted_cargos</code> are used instead.
Cargo types are from the <code>cargo_type_accept</code> callback, or the
<code>accepted_cargos</code> property if that callback failed.
Bits 0..3: Acceptance of first cargo type. Bits 4..7: Acceptance of second cargo
type. Bits 8..11: Acceptance of third cargo type.
<tr><td>slope_check<td>Same as for the <a href="#industries-callbacks-location-check-results">location_check</a> industry callback
<td>Called before constructing the industry, so nothing exists on the map yet.
Since the industry isn't built yet, so you can't access industry variables.
From the tile variables, relative x/y/position, town zone are available,
as well as the class, height, slope, terrain type and water status of nearby
tiles. <code>extra_callback_info2</code> contains the industry layout number
in the lowest (first) byte and the <a href="#industries-callbacks-creation-types">
creation type</a> in the second byte.
<tr><td>foundations<td>CB_RESULT[_NO]_FOUNDATIONS<td> Return CB_RESULT_FOUNDATIONS
to draw standard foundations (default) or CB_RESULT_NO_FOUNDATIONS to not draw them.
<tr><td>autoslope<td>CB_RESULT[_NO]_AUTOSLOPE<td>Return CB_RESULT_AUTOSLOPE to
allow autoslope (altering the ground below a tile) or CB_RESULT_NO_AUTOSLOPE to
disallow it.
</table>

<h3><a name="industrytiles-callbacks-animtriggers">Animation triggers</a></h3>
<table class="t">
<tr><th>Trigger</th><th>Meaning</th></tr>
<tr><td>ANIM_TRIGGER_INDTILE_CONSTRUCTION_STATE</td><td>the construction state changes </td></tr>
<tr><td>ANIM_TRIGGER_INDTILE_TILE_LOOP</td><td>the tile is processed in the periodic processing loop </td></tr>
<tr><td>ANIM_TRIGGER_INDTILE_INDUSTRY_LOOP</td><td>the industry of the tile is processed in the periodic processing loop (synchronized for all tiles) </td></tr>
<tr><td>ANIM_TRIGGER_INDTILE_RECEIVED_CARGO</td><td>the industry of the tile receives input cargo from a station (synchronized for all tiles) </td></tr>
<tr><td>ANIM_TRIGGER_INDTILE_DISTRIBUTES_CARGO</td><td>the industry distributes its output cargo to one of the stations nearby (synchronized for all tiles) </td></tr>
</table>


</body>
</html>

