<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>NML documentation</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<link rel="stylesheet" title="Standard Style" type="text/css" href="nml.css">
</head>
<body>

<h1><a name="objects">Objects</a></h1>

<h2><a name="objects-vars">Object variables</a></h2>
<table class="t">
<tr><th>name</th><th>value range</th><th>comment</th></tr>
<tr><td>relative_x</td><td>0..255</td><td>X-coordinate (top right -> bottom left) of the tile relative to the northernmost tile.</td></tr>
<tr><td>relative_y</td><td>0..255</td><td>Y-coordinate (top left -> bottom right) of the tile relative to the northernmost tile.</td></tr>
<tr><td>relative_pos</td><td>0xYYXX</td><td>A combination of relative_x and relative_y in the format 0xYYXX. Useful if you want to check for a single position.</td></tr>
<tr><td>terrain_type</td><td>TILETYPE_NORMAL, TILETYPE_DESERT, TILETYPE_RAIN_FOREST, TILETYPE_SNOW</td><td></td></tr>
<tr><td>tile_slope</td><td>Which corners are raised on the given tile.</td><td>
Bit 0: west corner is above the lowest corner.<br>
Bit 1: south corner is above the lowest corner.<br>
Bit 2: east corner is above the lowest corner.<br>
Bit 3: north corner is above the lowest corner.<br>
Bit 4: this tile is a steep slope (the corner opposite to the lowest corner is 2 units higher).<br>
See <a href="refs.html#refs-slopes">tile slopes</a> for an illustration
</td></tr>
<tr><td>build_date</td><td></td><td>The date this object was build.</td></tr>
<tr><td>animation_frame</td><td>0..255</td><td>Current animation frame</td></tr>
<tr><td>company_colour</td><td>0..15</td><td>Colour used for the company colour mask</td></tr>
<tr><td>owner</td><td>0..0x10</td><td>CompanyID of the owner of the object or 0x10 if it was build in the scenario editor</td></tr>
<tr><td>town_manhattan_dist</td><td></td><td>Manhattan distance to the nearest town</td></tr>
<tr><td>town_euclidean_dist</td><td></td><td>Euclidean distance to the nearest town</td></tr>
<tr><td>town_zone</td><td><a href="refs.html#refs-town-zones">town zone</a></td><td>The town zone of the current tile. The town zone from the closest town (measured in manhattan
distance) is used.</td></tr>
</table>

Variables that require some parameters.
<table class="t">
<tr><th>name</th>                        <th>arguments</th>           <th>value range</th> <th>comment</th></tr>
<tr><td>nearby_tile_object_type</td>     <td>x, y offset (-8..7)</td> <td></td> <td>ID of the object on a nearby tile, if defined by the same grf.
OBJECT_TYPE_OTHER_GRF if the object is defined by a different grf (or none at all). OBJECT_TYPE_NO_OBJECT if the tile does not contain an object.</td></tr>
<tr><td>nearby_tile_random_bits</td>     <td>x, y offset (-8..7)</td> <td></td> <td>Random bits of the given tile</td></tr>
<tr><td>nearby_tile_slope</td>           <td>x, y offset (-8..7)</td> <td></td> <td>See tile_slope</td></tr>
<tr><td>nearby_tile_is_same_object</td>  <td>x, y offset (-8..7)</td> <td>0 .. 1</td> <td>Is the given tile part of the same object?</td></tr>
<tr><td>nearby_tile_is_water</td>        <td>x, y offset (-8..7)</td> <td>0 .. 1</td> <td>Is the given tile a water tile?</td></tr>
<tr><td>nearby_tile_terrain_type</td>    <td>x, y offset (-8..7)</td> <td></td> <td>See terrain_type</td></tr>
<tr><td>nearby_tile_height</td>          <td>x, y offset (-8..7)</td> <td>0 .. 120</td> <td>The minimum height of the given tile. 8 units correspond to one height level</td></tr>
<tr><td>nearby_tile_class</td>           <td>x, y offset (-8..7)</td> <td><a href="refs.html#refs-tile-classes">Tile class</a></td> <td></td></tr>
<tr><td>nearby_tile_animation_frame</td> <td>x, y offset (-8..7)</td> <td></td> <td>See animation_frame</td></tr>
<tr><td>object_type_count</td>           <td>object id [, grfid]</td> <td>0..0xFFFF</td> <td>Number of objects with the given
object id currently on the map. Grfid is the grfid of the newgrf you want to check the object count of (default is current grf).</td></tr>
<tr><td>object_type_nearest</td>         <td>object id [, grfid]</td> <td>0..0xFFFF</td> <td>Manhattan distance to the closest object
of the given type. Grfid is the grfid of the newgrf you want to check the minimum object distance of (default is current grf). If the given
object type is not yet built, this will return 0xFFFF</td></tr>
</table>


<h2><a name="objects-property">Object properties</a></h2>
<table class="t">
<tr><th>property</th><th>value range</th><th>comment</th></tr>
<tr><td>class</td><td>String literal of length 4</td><td>Unlike station classes, there is currently no default
yet. You have to set the class ID before any other property or graphics. Characters allowed in the IDs are A-Z, 0-9. While
you are technically free to chose your own class, it's highly recommended you stick to one of the
<a href="#object-classes">default classes</a>.</td></tr>
<tr><td>classname</td><td>string</td><td>You only need to set this for one object
in every class.</td></tr>
<tr><td>name</td><td>string</td><td></td></tr>
<tr><td>climates_available</td><td>bitmask(CLIMATE_XXX, CLIMATE_YYY, ...)</td><td>XXX = [TEMPERATE | ARCTIC
| TROPICAL | TOYLAND], alternatively NO_CLIMATE or ALL_CLIMATES</td></tr>
<tr><td>size</td><td>[x, y]</td><td>Size in x and y direction. Both x and y must be compiletime constants</td></tr>
<tr><td>build_cost_multiplier</td><td></td><td>multiplicator to the base purchase cost</td></tr>
<tr><td>remove_cost_multiplier</td><td></td><td>multiplicator to the base removal cost</td></tr>
<tr><td>introduction_date</td><td>date</td><td>The date this object becomes available to build.</td></tr>
<tr><td>end_of_life_date</td><td>date</td><td>The last date this object is buildable. Must be at least 365 days after introduction_date</td></tr>
<tr><td>object_flags</td><td>bitmask(OBJ_FLAG_XXX, OBJ_FLAG_YYY)</td><td>See <a href="#object-flags">list of object flags</a></td></tr>
<tr><td>animation_info</td><td>Array [ANIMATION_XXX, frame-count]</td><td>XXX = [LOOPING | NON_LOOPING], 1..253 frames</td></tr>
<tr><td>animation_speed</td><td>0..16</td><td>Speed of animation, see <a href="refs.html#refs-animation-speed-values">animation speed table</a> for the meaning of the values.</td></tr>
<tr><td>animation_triggers</td><td></td><td></td></tr>
<tr><td>callback_flags</td><td>bitmask(OBJ_CBF_XXX, OBJ_CBF_YYY)</td><td>XXX = [SLOPE_CHECK | DECIDE_ANIM | DECIDE_ANIM_SPEED |
DECIDE_COLOUR | ADDITIONAL_TEXT | AUTOSLOPE]</td></tr>
<tr><td>height</td><td>0..255</td><td>Height of the object / 8. For example if your object is 16 pixels height you should
set height to 2. In OpenTTD this property is used to determine the height of the build object window; the height for the
object preview is set to 32 + "value of property" * 8. The property is also used to determine how high a bridge must be
if it is allowed by the bit in object_flags.</td></tr>
</table>

<h3><a name="object-classes">Default object classes</a></h3>
<p>Note: the class names listed below are recommended, you still need to set
the class name for at least one object in every class or you risk to end
up with objects in a class without a name. If multiple NewGRFs define objects
for the same class the name defined in the last NewGRF will be used.</p>
<table class="t">
<tr><th>Class</th><th>Name of the class</th><th>Description</th></tr>
<tr><td>STRU</td><td>Structures</td><td>Multitile engineered objects that don't quite fit in as industries, houses or stations - dams etc. </td></tr>
<tr><td>INFR</td><td>Infrastructure</td><td>lightpoles, communication towers, transmission towers, road signs, etc. </td></tr>
<tr><td>BLDG</td><td>Buildings</td><td>Normally accomodated by industries, houses or stations but the author feels there are limiting circumstances. </td></tr>
<tr><td>NATR</td><td>Natural objects</td><td>caves, coral reefs, swamps, etc. </td></tr>
<tr><td>PARK</td><td>Public areas</td><td>Normally accomodated by towns or industries (tourist stuff ...) but the author feels there are limiting circumstances - Parks, statues, etc. </td></tr>
<tr><td>ARTF</td><td>Artifacts</td><td>They really don't fit under any of the above - shipwrecks, etc. </td></tr>
<tr><td>MISC</td><td>Miscellaneous</td><td>For the author who is unable to accommodate his/her object under any of the previous labels.</td></tr>
</table>

<h3><a name="object-flags">List of object flags</a></h3>
<table class="t">
<tr><th>Name</th><th>Meaning</th></tr>
<tr><td>OBJ_FLAG_ONLY_SE</td><td>Only available in the scenario editor (incompatible with OBJ_FLAG_ONLY_INGAME)</td></tr>
<tr><td>OBJ_FLAG_IRREMOVABLE</td><td>Object cannot be removed with the normal dynamite tool. In OpenTTD you can only
remove the object with the magic bulldozer cheat, in TTDPatch you can remove it by holding ctrl while using the
bulldozer tool. The cost of removing this object is multiplied by 25.</td></tr>
<tr><td>OBJ_FLAG_ANYTHING_REMOVE</td><td>Anything can remove this object (owned land behavior)</td></tr>
<tr><td>OBJ_FLAG_ON_WATER</td><td>Allow construction of the object on water </td></tr>
<tr><td>OBJ_FLAG_REMOVE_IS_INCOME</td><td>Removal cost is actually income (owned land behaviour) </td></tr>
<tr><td>OBJ_FLAG_NO_FOUNDATIONS</td><td>Do not display foundations if on a slope </td></tr>
<tr><td>OBJ_FLAG_ANIMATED</td><td>Setting this flag will allow the object's animation counter to be increased, must
be set if you plan to make use of animations.</td></tr>
<tr><td>OBJ_FLAG_ONLY_INGAME</td><td>Only available during game play (incompatible with OBJ_FLAG_ONLY_SE)</td></tr>
<tr><td>OBJ_FLAG_2CC</td><td>Allows 2cc mapping for objects instead of the default 1cc </td></tr>
<tr><td>OBJ_FLAG_NOT_ON_LAND</td><td>Disallows construction on land (implies OBJ_FLAG_ON_WATER) </td></tr>
<tr><td>OBJ_FLAG_DRAW_WATER</td><td>Draws the water under the object. Only applies when built on top of a water tile,
also replaces the ground tile of the object completely. Does not work when object built on sloped water tiles.</td></tr>
<tr><td>OBJ_FLAG_ALLOW_BRIDGE</td><td>Allow bridge over the object taking the building height into account.</td></tr>
<tr><td>OBJ_FLAG_RANDOM_ANIMATION</td><td>Random bits in the "next animation frame" callback</td></tr>
</table>

<h3><a name="object-callbacks">List of object callbacks</a></h3>
<table class="t">
<tr><th>Name</th><th>Meaning</th></tr>
<tr><td>OBJ_CB_SLOPE_CHECK</td><td>Check for the slope of a tile
<tr><td>OBJ_CB_DECIDE_ANIM</td><td>Decide whether animation continues: 0xFF stops animation, 0xFE continues with next frame
<tr><td>OBJ_CB_DECIDE_ANIM_SPEED</td><td>Decide the animation frame to jump to. Or alternatively: 0xFF to stop animation, 0xFE
to start animation with current frame, 0xFD to keep the current animation frame and do nothing
<tr><td>OBJ_CB_DECIDE_COLOUR</td><td>Return the colour, or for 2 company colours the two colours, to be used. In the case of 2CC the 2nd company colour
goes into the high 4 bits of the return value
<tr><td>OBJ_CB_ADDITIONAL_TEXT</td><td>Return an additional string which is shown in the purchase menu. It should not exceed in length three lines.
<tr><td>OBJ_CB_AUTOSLOPE</td><td>Return a value different from 0 in order to disable autoslope behaviour.
</table>

</body>
</html>

