<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>NML documentation</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<link rel="stylesheet" title="Standard Style" type="text/css" href="nml.css">
</head>
<body>

<h1><a name="houses">Houses</a></h1>

<h2><a name="houses-property">House properties</a></h2>
<table class="t">
<tr><th>property <th>value range <th>comment
<tr><td>name<td>string<td>	for example string(STR_NAME_EIFFEL_TOWER)
<tr><td>substitute<td>0 ... 109<td>Number of the default house that replaces this one, if this house is not available for some reason.
This property <em>must</em> be set first, before any other properties or graphics. All properties of the old type are copied to your new house.
<tr><td>override<td>0 ... 109<td>id of the default house which this house replaces. This will cause your house to be placed instead of the default house.
This is ignored, if the default house has already been overridden. You can define this property multiple times
<tr><td>building_flags<td><td>HOUSE_FLAG_XX with XX = [SIZE_1x1, SIZE_2x1, SIZE_1x2, SIZE_2x2, NOT_SLOPED, ANIMATE, CHURCH, STADIUM, ONLY_SE, PROTECTED, SYNC_CALLBACK, RANDOM_ANIMATION]
<tr><td>population<td>0 ... 255<td>number of inhabitants the building adds to the town, if present
<tr><td>mail_multiplier<td>0 ... 255<td>
<tr><td>pax_acceptance<td>0 ... 1<td>Can be increased in steps of 0.125. A station accepts a cargo, if the combined acceptance of all houses in range is at least 1.
<tr><td>mail_acceptance<td>0 ... 1<td>
<tr><td>cargo_acceptance<td>0 ... 1<td>Like passenger acceptance. Additionally flag can be added which defines one of the cargo type: HOUSE_ACCEPT_GOODS, HOUSE_ACCEPT_FOOD, HOUSE_ACCEPT_FIZZY_DRINKS; FIZZY_DRINKS has in toyland the same meaning as FOOD in other climates.
<tr><td>accepted_cargo<td><td>up to three cargo labels, e.g. MAIL, PASS, COAL
<tr><td>local_authority_impact<td>0 ... 65525<td>amount of happiness increase of the city council, if the building is destroyed
<tr><td>removal_cost_multiplier<td>0 ... 255<td>
<tr><td>probability<td>0 ... 16<td>Probability with respect to the default houses (=1). Mind that these are relative probabilities with respect to all houses defined. If all probabilities are defined as 16, they'll all have the same probability as if they had all a probability of 1.
<tr><td>years_available<td>array of two int<td>[xx, yy] where xx and yy indicate the introduction year and the last year the building can be built
<tr><td>minimum_lifetime<td>0 ... 255<td>number of years the building will remain at least
<tr><td>availability_mask<td>[bitmask(<a href="refs.html#refs-town-zones">town zones</a>), bitmask(CLIMATE_XXX, ...)]<td>An array with two bitmasks, the first
bitmask is a mask of town zones where this house is available. The second bitmask is a mask of climates combined with the special value ABOVE_SNOWLINE
which you need to set for houses available in the arctic climate above the snowline.<br>
Examples:
<ul>
<li>Available in the centre town zone in toyland only: <code>[bitmask(TOWNZONE_CENTRE), bitmask(CLIMATE_TOYLAND)]</code></li>
<li>Available in all town zones in the arctic climate both above and below the snowline: <code>[ALL_TOWNZONES, bitmask(CLIMATE_ARCTIC, ABOVE_SNOWLINE)]</code></li>
<li>Available everywhere except on the town edge: <code>[ALL_TOWNZONES &amp; ~bitmask(TOWNZONE_EDGE), ALL_CLIMATES | bitmask(ABOVE_SNOWLINE)</code></li>
</ul>
<tr><td>callback_flags<td>bitmask(HOUSE_CBF_XX)<td>Do not set this, unless you use <a href="old-callbacks.html">old-style callbacks</a>.
<tr><td>random_colours<td>array of 4, each COLOUR_XXX<td>colour values in an array, refer to the table <a href="refs.html#refs-palettes-helpers">here</a> for a list of possible values.
<tr><td>refresh_multiplier<td>0 ... 63<td>Defines the frequency with which the tile will be re-randomized which has an impact for random animation.
<tr><td>animation_info</td><td>Array [ANIMATION_XXX, frame-count]</td><td>XXX = [LOOPING | NON_LOOPING], 1..128 frames</td></tr>
<tr><td>animation_speed<td>2 ... 16<td>Speed of animation, see <a href="refs.html#refs-animation-speed-values">animation speed table</a> for the meaning of the values.
<tr><td>building_class<td>0 .. 255<td>An arbitrary number. You can check for the presence of buildings of the same class when building new buildings or using animation
</table>

<h2><a name="houses-vars">House variables</a></h2>
<p>House variables are not yet implemented in NML</p>

<h2><a name="houses-callbacks">House callbacks</a></h2>
<table class="t">
<tr><th>callback<th>return value<th>comment
<tr><td>default<td>Sprite layout<td>Graphics for the house tile
<tr><td>random_trigger<td>N/A<td>See <a href="nml-language.html#block-randomswitch">
random switch</a> for more information.
<tr><td>anim_next_frame<td>Next animation frame or CB_RESULT_XXX<td>Called for
every animation frame, returns the next frame to display. Alternatively,
return CB_RESULT_NEXT_FRAME or CB_RESULT_STOP_ANIMATION to show the next frame
or stop animation, respectively. <code>extra_callback_info1</code> contains
random bits, if enabled in the <code>special_flags</code> property.  Returning a
sound effect in the high byte will cause that sound effect to be played.
<tr><td>anim_control<td>Next animation frame or CB_RESULT_XXX<td>Called every
256 ticks. Return the animation frame to show, or CB_RESULT_XXX with
XXX = [CB_RESULT_START_ANIMATION | STOP_ANIMATION | DO_NOTHING]
to respectively start the animation in its current frame, stop the animation or
do nothing. <code>extra_callback_info1</code> contains random bits, if enabled
in the <code>building_flags</code> property.  Returning a sound effect in the
high byte will cause that sound effect to be played.
<tr><td>construction_anim<td>Same as <code>anim_control</code><td>Works the same
as the <code>anim_control</code> callback, except that it's called when the
construction state changes.
<tr><td>watched_cargo_accepted<td>Same as <code>anim_control</code><td>Works the same
as the <code>anim_control</code> callback, except that it's called when one of the
watched cargo types is accepted.
<tr><td>anim_speed<td>0 .. 16<td>Decide the time an animation frame should last.
Return value is interpreted as (num_ticks = 2^anim_speed), which each tick lasting
30 ms. Avoid using this callback if possible, since it has to be called each tick
for every animated tile. This can be used to create animation frames that last
between 30 ms and 33 minutes.
<tr><td>cargo_type_accept<td>type1 + (type2 &lt;&lt; 5) + (type3 &lt;&lt; 10)<td>
Decide the cargo types that this tile accepts. If this callback is not
implemented or fails, the values from <code>accepted_cargo</code> are used instead.
Bits 0..4: First cargo type. Bits 5..9: Second cargo type. Bits 10..14: Third cargo type.
<tr><td>cargo_amount_accept<td>amt1 + (amt2 &lt;&lt; 4) + (amt3 &lt;&lt; 8)<td>
Acceptance for each cargo amount in 1/8th. If this callback is not
implemented or fails, the values from the acceptance properties are used instead.
Cargo types are from the <code>cargo_type_accept</code> callback, or the
<code>accepted_cargo</code> property if that callback failed.
Bits 0..3: Acceptance of first cargo type. Bits 4..7: Acceptance of second cargo
type. Bits 8..11: Acceptance of third cargo type.
<tr><td>cargo_production<td>(cargo_type * 256) + amount<td>Called every 256 ticks.
Called multiple times until 0x20FF is returned. The high byte of the result
contains a cargo type, the low byte contains the amount of that cargo to produce.
<code>extra_callback_info1</code> contains the number of iterations so far,
<code>extra_callback_info2</code> contains random bits.
<tr><td>foundations<td>CB_RESULT[_NO]_FOUNDATIONS<td> Return CB_RESULT_FOUNDATIONS
to draw standard foundations (default) or CB_RESULT_NO_FOUNDATIONS to not draw them.
<tr><td>autoslope<td>CB_RESULT[_NO]_AUTOSLOPE<td>Return CB_RESULT_AUTOSLOPE to
allow autoslope (altering the ground below a tile) or CB_RESULT_NO_AUTOSLOPE to
disallow it.
<tr><td>name<td>String<td>Name of the building (when using tile query tool)
<tr><td>colour<td>Palette number<td>Used to recolour the building. See here
<a href="refs.html#refs-palettes">here</a> for an overview of default palettes.
<tr><td>construction_check<td>0 or 1<td>Return 1 to allow building the house or
0 to disallow.
<tr><td>destruction<td>0 or 1<td>Called periodically. Return 0 to keep the building
or 1 to destroy it.
<tr><td>protection<td>0 or 1<td>Return 0 to allow destruction, or 1 to disallow
</table>

</body>
</html>

