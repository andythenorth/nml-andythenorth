<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>NML documentation</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<link rel="stylesheet" title="Standard Style" type="text/css" href="nml.css">
</head>
<body>

<h1><a name="airports">Airports and airport tiles</a></h1>

<h2><a name="airports-properties">Airport properties</a></h2>
<table class="t">
<tr><th>name</th><th>value range</th><th>comment</th></tr>
<tr><td>name<td>string<td>Name of the airport
<tr><td>override<td><td>the id of airport to replace / override
<tr><td>layouts<td>list of layouts<td>
<tr><td>years_available<td>[start year, last year]<td>list of the availablility years: first and last year it can be built 
<tr><td>ttd_airport-type<td>0 ... 3<td>substitute TTDPatch airport type
<tr><td>catchment_area<td><td>catchment area of the airport in tiles around its perimeter
<tr><td>noise_level<td><td>noise generation of this airport
</table>

<h2><a name="airporttiles-properties">Airport tile properties</a></h2>

<table class="t">
<tr><th>name</th><th>value range</th><th>comment</th></tr>
<tr><td>override<td><td>the id of airport tile to override
<tr><td>substitute<td><td>the id of airport tile to replace
<tr><td>callback_flags<td>bitmask<td>Do not set this, unless you use <a href="old-callbacks.html">old-style callbacks</a>.
<tr><td>animation_info<td><td>
<tr><td>animation_speed<td><td>see <a href="refs.html#refs-animation-speed-values">speed settings</a>
<tr><td>animation_triggers<td>bitmask(ANIM_TRIGGER_APT_XXX, ... )<td>Bitmask of
triggers that will trigger animation, see the <a href="#airporttiles-callbacks-animtriggers">table</a> below.
</table>

<h2><a name="airports-vars">Airport variables</a></h2>

<table class="t">
<tr><th>name</th><th>value range</th><th>comment</th></tr>
<tr><td>layout<td>0 .. (number of layouts - 1)<td>Layout number of the airport (index in the layouts array)
</table>


<h2><a name="airporttiles-vars">Airport tile variables</a></h2>

<table class="t">
<tr><th>name</th><th>value range</th><th>comment</th></tr>
<tr><td>terrain_type<td><td>
<tr><td>town_radius_group<td><td>
<tr><td>relative_x<td>0..255<td>X-coordinate (top right -> bottom left) of the tile relative to the northernmost tile.
<tr><td>relative_y<td>0..255<td>Y-coordinate (top left -> bottom right) of the tile relative to the northernmost tile.
<tr><td>relative_pos<td>0xYYXX<td>A combination of relative_x and relative_y in the format 0xYYXX. Useful if you want to check for a single position.
<tr><td>animation_frame<td><td>
</table>

Variables that require a signed x,y offset. The offset is relative to the current tile. Offset 0,0 means the current tile.
<table class="t">
<tr><th>name</th><th>value range</th><th>comment</th></tr>
<tr><td>nearby_tile_slope</td><td>Which corners are raised on the given tile.</td><td>
Bit 0: west corner is above the lowest corner.<br>
Bit 1: south corner is above the lowest corner.<br>
Bit 2: east corner is above the lowest corner.<br>
Bit 3: north corner is above the lowest corner.<br>
Bit 4: this tile is a steep slope (the corner opposite to the lowest corner is 2 units higher).<br>
See <a href="refs.html#refs-slopes">tile slopes</a> for an illustration
</td></tr>
<tr><td>nearby_tile_is_same_airport</td><td>1 if the tile is part of the same airport, 0 otherwise</td><td></td></tr>
<tr><td>nearby_tile_is_water</td><td>1 if the tile is water, 0 otherwise</td><td></td></tr>
<tr><td>nearby_tile_terrain_type</td><td>TILETYPE_XX</td><td>TILETYPE_NORMAL, TILETYPE_DESERT, TILETYPE_RAIN_FOREST, TILETYPE_SNOW</td></tr>
<tr><td>nearby_tile_height</td><td>0..120</td><td>The height of the lowest corner of the given tile.</td></tr>
<tr><td>nearby_tile_class</td><td><a href="refs.html#refs-tile-classes">Tile class</a></td><td></td></tr>
<tr><td>nearby_tile_animation_frame</td><td>0..255</td><td>Animation frame of the given tile</td></tr>
<tr><td>nearby_tile_airporttile_id</td><td>0x00aa, 0xFFbb, 0xFFFE or 0xFFFF</td><td>
0x00aa: The tile is an airport tile that is part of this GRF, the tile id is aa.<br>
0xFFbb: The tile is an original airport tile with id bb.<br>
0xFFFE: The tile is an airport tile defined in another GRF.<br>
0xFFFF: The tile is not an airport tile or it belongs to another GRF.
</td></tr>
</table>

<h2><a name="airports-callbacks">Airport callbacks</a></h2>
<table class="t">
<tr><th>callback<th>return value<th>comment
<tr><td>default<td>Sprite group<td>Preview graphics to use in the build menu
<tr><td>additional_text<td>String<td>Additional text to show in the buy menu
<tr><td>layout_name<td>String<td>Name of the airport layout in the variable <code>layout</code>
</table>

<p>Note that, although the airport isn't built yet, the <code>layout</code>
variable is always available and set to the layout the user has selected in
the GUI.</p>

<h2><a name="airporttiles-callbacks">Airport tile callbacks</a></h2>
<table class="t">
<tr><th>callback<th>return value<th>comment
<tr><td>default<td>Sprite group<td>Normal graphics for an object placed on the map
<tr><td>anim_next_frame<td>Next animation frame or CB_RESULT_XXX<td>Called for
every animation frame, returns the next frame to display. Alternatively,
return CB_RESULT_NEXT_FRAME or CB_RESULT_STOP_ANIMATION to show the next frame
or stop animation, respectively. <code>extra_callback_info1</code> contains
random bits.
<tr><td>anim_control<td>Next animation frame or CB_RESULT_XXX<td>Called whenever
an object animation trigger happens. Return the animation frame to show, or
CB_RESULT_XXX with XXX = [CB_RESULT_START_ANIMATION | STOP_ANIMATION | DO_NOTHING]
to respectively start the animation in its current frame, stop the animation or
do nothing. <code>extra_callback_info1</code> contains random bits.
<code>extra_callback_info2</code> contains the reason to trigger the animation,
see the <a href="#airporttiles-callbacks-animtriggers">table</a> below. Note
that you need to enable the wanted triggers in the <code>animation_triggers</code>
property.
<tr><td>anim_speed<td>0 .. 16<td>Decide the time an animation frame should last.
Return value is interpreted as (num_ticks = 2^anim_speed), which each tick lasting
30 ms. Avoid using this callback if possible, since it has to be called each tick
for every animated tile. This can be used to create animation frames that last
between 30 ms and 33 minutes.
<tr><td>foundations<td>CB_RESULT[_NO]_FOUNDATIONS<td> Return CB_RESULT_FOUNDATIONS
to draw standard foundations (default) or CB_RESULT_NO_FOUNDATIONS to not draw them.
</table>

<h3><a name="airporttiles-callbacks-animtriggers">Animation triggers</a></h3>
<table class="t">
<tr><th>Animation trigger<th>Description
<tr><td>ANIM_TRIGGER_APT_BUILT<td>Airport is built (all tiles at the same time)
<tr><td>ANIM_TRIGGER_APT_TILELOOP<td>Airport tile is processed in the tileloop
(at different times for different tiles)
<tr><td>ANIM_TRIGGER_APT_NEW_CARGO<td>New cargo arrives at the airport (all tiles at the same time)
<tr><td>ANIM_TRIGGER_APT_CARGO_TAKEN<td>All cargo of a cargo type is removed from the airport (all tiles at the same time)
<tr><td>ANIM_TRIGGER_APT_250_TICKS<td>Every 250 ticks (all tiles at the same time)
</table>
</body>
</html>
