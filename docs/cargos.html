<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>NML documentation</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<link rel="stylesheet" title="Standard Style" type="text/css" href="nml.css">
</head>
<body>

<h1><a name="cargos">Cargoes</h1>

<h2><a name="cargos-property">Cargo properties</a></h2>
<table class="t">
<tr><th>name</th><th>value range</th><th>comment</th></tr>
<tr><td>number</td>                   <td>0..31</td><td>Number of the cargo for bitmasks.</td></tr> <!-- Add link to the default cargos -->
<tr><td>type_name</td>                <td>string</td><td>TextID for the cargo type name. Example string: "Passengers"</td></tr>
<tr><td>unit_name</td>                <td>string</td><td>TextID for the name of one unit from the cargo type. Currently used for subsidies only (First Passenger service to..). Example string: "Passenger"</td></tr>
<tr><td>single_unit_text</td>         <td>string</td><td>TextID to be displayed for 1 unit of cargo. Example string: "{WORD_S} ton of Stuff"</td></tr>
<tr><td>multiple_units_text</td>      <td>string</td><td>TextID to be displayed for multiple units of cargo. Example string: "{WORD_S} tonnes of Stuff"</td></tr>
<tr><td>type_abbreviation</td>        <td>string</td><td>TextID for cargo type abbreviation. Example string: "{TINYFONT}XX"</td></tr>
<tr><td>sprite</td>                   <td>sprite</td><td>TTD sprite number for the icon of the cargo. Alternatively, set to NEW_CARGO_SPRITE and use a graphics block to define a custom sprite.</td></tr>
<tr><td>weight</td>                   <td>float 0..255</td><td>Weight of one unit of the cargo (in tons)</td></tr>
<tr><td>penalty_lowerbound</td>       <td>0..255</td><td>Delivery time until penalty is applied</td></tr>
<tr><td>single_penalty_length</td>    <td>0..255</td><td>Length of the interval where a single penalty is applied</td></tr>
<tr><td>price_factor</td>             <td>float</td><td>Payment for delivering 10 units of cargo across a distance of 20 squares (in British Pounds).</td></tr>
<tr><td>station_list_colour</td>      <td>0..255</td><td>Colour for the station list window (index from the <a href="nml-language.html#graphic-files">DOS palette</a>)</td></tr>
<tr><td>cargo_payment_list_colour</td><td>0..255</td><td>Colour for the cargo payment list window (index from the <a href="nml-language.html#graphic-files">DOS palette</a>)</td></tr>
<tr><td>is_freight</td>               <td>0 or 1</td><td>Freight status (for the freighttrains switch); 0=not freight, 1=is freight</td></tr>
<tr><td>cargo_classes</td>            <td>bitmask(<a href="#cargo-classes">cargo classes</a>)</td><td>Cargo classes</td></tr>
<tr><td>cargo_label</td>              <td>4 letters</td><td>Cargo label, as used in the cargo table</td></tr>
<tr><td>town_growth_effect</td>       <td>TOWNGROWTH_XXX</td><td>Effect for town growth, see <a href="#town-growth-cargo">Cargo effects on town growth</a></td></tr>
<tr><td>town_growth_multiplier</td>   <td>float 0..255</td><td>Multiplier for town growth. To be used in conjuction with town_growth_effect, when that is not TOWNGROWTH_NONE.
For example, a value of 4 makes your cargo have the same effect on town growth as 4 units of food/goods/etc.</td></tr>
<tr><td>callback_flags</td>           <td>bitmask(flags)</td><td>Do not set this, unless you use <a href="old-callbacks.html#old-callbacks-cargos">old-style callbacks</a>.</td></tr>
</table>
Cargo payment is computed from <code>price_factor</code>, amount of cargo transported,
distance, and a time delivery factor. Unit of the delivery time is 185 ticks,
roughly 2.5 days. The factor is constant (with value 255) if delivery time is
less than <code>penalty_lowerbound</code>. It goes down with rate 1 between
<code>penalty_lowerbound + single_penalty_length</code>, and goes down with
rate 2 if the delivery time is even longer. Time delivery factor is never less
than 31.

<h3><a name="cargo-classes">Cargo classes</a></h3>
<p>Available cargo classes are listed in the following table. Cargos may be in
more than one class. To combine multiple cargo classes, use the builtin function bitmask.
For example, <code>bitmask(CC_EXPRESS, CC_REFRIGERATED)</code> is used for food.</p>
<table class="t">
<tr><th>name <th> type of cargo
<tr><td>CC_PASSENGERS<td> passengers, also tourists (ECS)
<tr><td>CC_MAIL<td> mail
<tr><td>CC_EXPRESS<td> express goods, also tourists (ECS)
<tr><td>CC_ARMOURED<td> valuables, diamonds, gold and alike
<tr><td>CC_BULK<td> coal, ore, grain,...
<tr><td>CC_PIECE_GOODS<td> containers, crates, livestock
<tr><td>CC_LIQUID<td> oil, milk, water, ...
<tr><td>CC_REFRIGERATED<td> food, milk, ...
<tr><td>CC_HAZARDOUS<td> chemicals?, uranium, ...
<tr><td>CC_COVERED<td> grain, cement, fruit, ...
<tr><td>CC_OVERSIZED<td> vehicles, ...
<tr><td>CC_SPECIAL<td> Special cargo, used for refit tricks. (e.g. regearing in NARS)
<tr><td>NO_CARGO_CLASS<td>Special value that you can used to instead of 0.
<tr><td>ALL_NORMAL_CARGO_CLASSES<td>Bitmask of all cargo classes except CC_SPECIAL. This is the same as <code>bitmask(CC_PASSENGERS, CC_MAIL, ..., CC_OVERSIZED)</code>.
Note: This is already a bitmask, don't use the <code>bitmask(..)</code> function with this.
<tr><td>ALL_CARGO_CLASSES<td>Bitmask of all cargo classes. Same as <code>ALL_NORMAL_CARGO_CLASSES | bitmask(CC_SPECIAL)</code>
Note: This is already a bitmask, don't use the <code>bitmask(..)</code> function with this.
</table>

<h3><a name="town-growth-cargo">Cargo effects on town growth</a></h3>
<table class="t">
<tr><th>value</th><th>effect</th></tr>
<tr><td>TOWNGROWTH_PASSENGERS</td><td>Affect towns as passengers do</td></tr>
<tr><td>TOWNGROWTH_MAIL</td>      <td>Affect towns as mail does</td></tr>
<tr><td>TOWNGROWTH_GOODS</td>     <td>Affect towns as goods/candy does</td></tr>
<tr><td>TOWNGROWTH_WATER</td>     <td>Affect towns as water does (second required cargo for towngrowth in the desert)</td></tr>
<tr><td>TOWNGROWTH_FOOD</td>      <td>Affect towns as food/fizzy drinks do (first required cargo for towngrowth in desert/above snowline)</tr></td>
<tr><td>TOWNGROWTH_NONE</td>      <td>Don't affect town growth (default)</td></tr>
</table>

<h2><a name="cargos-vars">Cargo variables</a></h2>
<p>Cargos have no variables (yet).</p>

<h2><a name="cargos-callbacks">Cargo callbacks</a></h2>
<table class="t">
<tr><th>callback<th>return value<th>comment
<tr><td>default<td>Sprite group<td>Graphics for the cargo icon (only if property <code>sprite</code> is set to NEW_CARGO_SPRITE)
<tr><td>station_rating<td>-16384 .. 16383<td>See detailed explanation below
<tr><td>profit<td>-16384 .. 16383<td>Called whenever cargo is delivered.
<code>extra_callback_info2</code> contains <code>0xttaadddd</code> with
<code>tt</code> being the time spent en-route (1 unit = 2.5 days),
<code>aa</code> the amount of cargo delivered and
<code>dddd</code> the manhattan distance it was transported. The returned
value is multiplied by the amount and the <code>price_factor</code> and then
divided by 8192 to determine the income the player receives. Returning negative
values is possible, it makes players pay for the delivery.
</table>

<h3><a name="cargos-callbacks-rating">Station rating callback</a></h3>
<p>The station rating callback is quite complicated and deserves some
detailed explanation. The default station rating calculation works as
follows:</p>
<p>Internally, station rating is byte with values 0 .. 255, representing
respectively 0% and 100%. Every 2.5 days, the transportation 'performance'
is calculated using some factors outlined below. The station rating is then
set to this performance value, with the caveat that the rating change cannot
exceed 2 points. Therefore, rating changes are always slow, this callback cannot
change this. The initial rating is 175 points (69%). The following factors
are parts of the performance, their effects are summed.</p>

<h4>Time since the cargo was last picked up</h4>
<table class="t">
<tr><th>Time units (days)<th>Score (%, rounded)
<tr><td>&gt;21 (&gt;52.5 days)<td>0 (0%)
<tr><td>13 .. 21 (32.5 days .. 52.5 days)<td>25 (10%)
<tr><td>7 .. 12 (17.5 days .. 32.5 days)<td>50 (20%)
<tr><td>4 .. 6 (10 days .. 17.5 days)<td>95 (37%)
<tr><td>0..3 (0 days..10 days)<td>130 (51%)
</table>
<p>The time unit used equals 185 engine ticks, or 2.5 TTD days. For ships,
the time units are divided by 4 before calculating this component, so ships
have four times more time before the ratings start dropping.</p>

<h4>Amount of cargo waiting</h4>
<table class="t">
<tr><th>Amount of cargo<th>Score (%, rounded)
<tr><td>&gt;1500<td>-90 (-35%)
<tr><td>1001..1500<td>-35 (-14%)
<tr><td>601..1000<td>0 (0%)
<tr><td>301..600<td>10 (4%)
<tr><td>101..300<td>30 (12%)
<tr><td>0..100<td>40 (16%)
</table>

<h4>Max. speed of the last vehicle picking up the cargo</h4>
<p>This calculation is somewhat complicated. The maximum speed of the vehicle
is expressed in "speed units". For trains and road vehicles, the speed unit is
1 km/h; for ships, it's 0.5 km/h; for aircraft, it's 8 mph. If the max. speed
is above 255 speed units, 255 is used instead. If the vehicle is slower than
85 units, no points are awarded; otherwise, you get (speed_units-85)/4 points.
Therefore, the maximum you can get is 42 points, or 16%.</p>

<h4>Age of the last carrier picking up the cargo</h4>
<table class="t">
<tr><th>Age of vehicle (years)<th>Score (%, rounded)
<tr><td>2<td>10 (4%)
<tr><td>1<td>20 (8%)
<tr><td>0<td>33 (13%)
</table>
<p>In TTDPatch this changes when the 'newagerating' switch is enabled</p>

<h4>Bonus for AI companies (TTDPatch only)</h4>
<table class="t">
<tr><th>AI intelligence setting<th>Score (%, rounded)
<tr><td>Low<td>0 (0%)
<tr><td>Medium<td>31 (12%)
<tr><td>High<td>63 (25%)
</table>

<h4>Bonus for statue in nearest town</h4>

<p>If your company has erected a statue in the nearest town, you get 26 points (10%) bonus to all cargo ratings.
</p>
<h4>Effect of callback</h4>
<p>The return value of the callback replaces the first three components
(time since pickup, amount of cargo, max speed) of the calculation.
The bonus for statues, TTDPatch AIs and new vehicles is always in effect,
you cannot (yet) change this.</p>

</body>
</html>

